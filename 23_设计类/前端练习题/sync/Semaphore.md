# TypeScript 实现 Semaphore 类

## Semaphore 实现详解

### 核心属性

1. `_count`: 表示可用资源数量
2. `_waitingQueue`: 等待获取资源的队列，按照先进先出(FIFO)的顺序管理

### 主要方法

1. **构造函数**:

   - 接受一个可选的初始计数值（默认为1）
   - 验证参数有效性，不允许负数计数

2. **acquire(timeout?)**:

   - 异步方法，尝试获取一个资源（减少计数器）
   - 如果资源不可用（计数为0），则进入等待队列
   - 支持超时机制，超时后会从等待队列移除并拒绝Promise

3. **tryAcquire()**:

   - 非阻塞方法，尝试获取资源
   - 成功获取返回true，失败返回false
   - 不会进入等待状态

4. **release(count?)**:

   - 释放指定数量的资源（默认为1）
   - 如果有线程在等待，会优先唤醒等待线程
   - 否则增加内部计数器

5. **execute(fn)**:
   - 高级封装，用于执行受信号量保护的函数
   - 确保资源获取和释放的正确顺序
   - 支持异步函数，自动处理Promise

### 特性

1. **公平性**：

   - 使用队列确保先请求的线程先获得资源

2. **超时机制**：

   - acquire方法支持超时参数，避免无限等待

3. **类型安全**：

   - 完全利用TypeScript类型系统，提供类型安全的API

4. **健壮性**：
   - 异常处理和参数验证
   - 使用try-finally确保资源正确释放

### 使用场景

1. **限制并发访问**：

   - 限制对数据库、API或其他资源的并发请求数

2. **实现资源池**：

   - 管理有限数量的连接或资源实例

3. **协调生产者-消费者模式**：

   - 控制生产者和消费者之间的流量

4. **实现更复杂的同步机制**：
   - 可以用作构建其他同步原语的基础

这个实现是完全异步的，适用于Node.js或浏览器环境中的并发控制。
