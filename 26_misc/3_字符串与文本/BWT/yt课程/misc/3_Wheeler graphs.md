**Wheeler Graphs** 是一类在文本索引、基因组组装、压缩数据结构等场景中日益受到关注的图结构，最早由 _Gagie, Manzini, Sirén_ 等人在 2017 年前后提出。它背后的动机，是想用一个统一的图模型来描述和刻画**类似 FM-index / BWT** 那样的“行挨着行的有序结构”，进而在图（而非单纯线性文本）上实现类似 Burrows–Wheeler 变换（BWT）索引的功能。下面从概念、性质、构造和应用四个方面进行详细讲解。

---

## 1. Wheeler Graph 的背景和动机

在经典的 **文本索引** 设计里（如 **FM-index**、**BWT-based** 结构），我们借助 **Burrows–Wheeler transform (BWT)** 对线性字符串执行重排，并通过行（后缀）之间的**字典序关系**在压缩后仍能保留搜索能力。这些技术给了我们**低空间占用**与**高效子串搜索**，在大规模文本、基因组序列分析等场景非常重要。

然而，很多数据并不是纯粹的线性序列，而是带有**分支**或**多重路径**的结构（如**多版本基因组**、**多分支文本**、**词图**等）。

- 如果直接把它们视为字符串的集合，可能需要维护大量重复，浪费空间；
- 如果能在一个**“带有有序条件”**的**有向图**上做类似 BWT 的索引，就能在图结构中直接搜索模式。

**Wheeler Graph** 就是这样一类**可被“BWT 方式”线性化**的图。它具有某种**“可排序性”**，使得图中边与节点能按照一个全局顺序满足类似 BWT 的性质，从而**支持在图中做快速的子串/模式查询**。

---

## 2. Wheeler Graph 的定义

粗略概念上，给定一个有向图 \(G\)（通常有标记在边或节点上），要称它为 Wheeler Graph，必须存在一种对顶点（或边）施加的**线性顺序**，满足：

1. **入边排序一致**
   - 若我们在图中可以对顶点进行某种线性排列 \(\prec\)，那么对每个节点 \(v\)，从不同前驱节点指向 \(v\) 的边必须以该前驱在 \(\prec\) 中的顺序来排序，并且在边标签上也必须满足一个一致性；
2. **“同标记边”的相对顺序**
   - 如果两条边有相同的标签（如相同字符），并且它们的源节点在 \(\prec\) 中某种次序，目标节点在 \(\prec\) 中也必须保持对应的单调关系（这个细节可能因文献略有差异，但核心是“同标签边不会发生交叉”）；

通俗地说：

- 在 Wheeler Graph 里，我们可以把图的节点从左到右排成一行；
- 如果边有标签 \(\alpha\) (或字符 \(\alpha\))，那么**同字符**的边从左到右不会“交叉重叠”；
- 并且，每个节点的边按照源节点顺序，可以决定目标节点顺序的一致性。

### 2.1 更正式的表述

如 _Gagie, Manzini, Sirén (2017)_ 等文献所述，一个有向图 \(G=(V,E,\Sigma)\)（其中边带有标签 \(\Sigma\) 中的字符）是 **Wheeler Graph** 若存在对 \(V\) 的全序 \(\prec\)，使得对任意两条边 \(e_1: u_1 \to v_1\) 与 \(e_2: u_2 \to v_2\)，其标签分别为 \(c_1, c_2\)，有下面性质：

- 如果 \(c_1 < c_2\)（字符上字典序更小），则 \(v_1 \prec v_2\)；
- 如果 \(c_1 = c_2\) 并且 \(u_1 \prec u_2\)，则 \(v_1 \prec v_2\).

这就强制了**同字符边**保持某种“同向单调”，不同字符也要分段。

从这可看出 Wheeler Graph 与 Burrows–Wheeler transform (BWT) 里的“行排序 + 下一列”概念非常契合：我们把行（节点）依照 BWT 行顺序排开，则同字符边不会交叉“跳过”别的字符的边。

---

## 3. Wheeler Graph 的性质

1. **可“线性顺序化”**
   - Wheeler Graph 必须存在一个对节点（或某些场景下对边）进行的**全序**，满足以上不交叉、单调等条件。若图不具备这种顺序，就不是 Wheeler Graph。
2. **对子串匹配的支持**
   - 在 Wheeler Graph 中，可以像在 BWT/FM-index 里那样，用**“逆向字符匹配”**去定位可能的下一个节点范围，从而在图上做模式搜索。
3. **紧密联系 BWT**
   - 若对 Wheeler Graph 的节点按该线性顺序列出来，再查看节点的入边字符，就可以形成类似“BWT列”的结构，对搜索非常有用。
4. **局部无歧义**
   - 如果有两条同字符边来自节点 \(u_1\) 和 \(u_2\)，且 \(u_1 \prec u_2\)，则目标节点也保持 \(\prec\) 的顺序，不会产生交叉并造成匹配路径的混乱。

### 3.1 例子：字符串的后缀自动机 / 后缀 trie

- 若我们对单个字符串构造后缀自动机（或某些压缩版 Trie），并做适当有序化，就可得到 Wheeler Graph。
- 这基本对应了 BWT 在串上的 FM-index。 Wheeler Graph 可以被视作 FM-index 在更一般图结构上的推广。

### 3.2 构造 / 识别 Wheeler Graph

- _Gagie et al._ 证明了如何在多模字符串、或者特定类型的压缩词典上识别 Wheeler Graph 并进行构造。
- 识别一个给定有向图是否是 Wheeler Graph（并找到那条“Wheeler顺序”）在一般情况可能有多项式算法，也有一些情况是 NP-hard (具体视图结构、标签约束而定)。 研究仍在继续探索最优算法。

---

## 4. Wheeler Graph 的应用

1. **紧凑文本索引**

   - 传统 BWT/FM-index 将一个字符串构造成低空间可搜索的结构。如果把数据扩展成带分支的多字符串图（如基因组变体图），就能使用 Wheeler Graph 原理做**图 FM-index**。
   - 在生物信息学中，基因组图索引（基因组序列可能包含很多变体 path）是一个热点。 Wheeler Graph 提供了**理论模型**来统一地看待**BWT-based**索引对图的适用性。

2. **基因组变体图索引**

   - 现代基因组分析常常有**多版本**序列，用**variation graph**（如 **VG**）表征差异。若这个图能嵌入 Wheeler Graph 结构，就能用类似 BWT 的方法做**快速 read mapping**、**子串匹配**等。
   - _Sirén, Mäkinen_ 等不少学者在研究如何构造实际可用的 Wheeler Graph 以支持**pangenome**检索。

3. **多文本 / 词图搜索**

   - 假设我们把多字符串“合并”到一个图里（共享公共前缀/后缀），若这图满足 Wheeler 性质，我们就能对整合集做同样高效的搜索。
   - 可能用于搜索引擎的紧凑索引、压缩词典等。

4. **通用大数据压缩索引**
   - Wheeler Graph 的线性顺序让**边**或**节点**可以像 BWT 那样做**行排序**，继而可进行高效压缩（Run-length, Huffman, etc.）并且仍然支持子串查询。

---

## 5. 构造及挑战

**怎么把一般图转化为 Wheeler Graph**或**判断图是否是 Wheeler Graph**，有一定难度：

1. **若原图不是 Wheeler Graph**，必须做改造 / 子图 / 模式。
2. **对 Wheeler ordering** 的寻找，需要多重约束：
   - 同标签边顺序必须保持一致；
   - 不同标签要分段；
   - 不能出现交叉冲突。
3. **规模问题**：在大规模基因组图等场景下，图可包含千万级节点/边，如何高效构造 Wheeler ordering 并进行索引仍是研究热点。

---

## 6. 总结

**Wheeler Graph** 提供了一个高度抽象的理论框架，将 **BWT / FM-index** 这一**字符串上**的索引思想推广到**有向图**场景，从而在多路径结构中保留那种“行顺序 + 下一列字符”的单调性，支持**高效的子串搜索**。它的主要特性：

- 存在一个全局线性顺序，让**相同字符的边**保持不交叉；
- 可以视为**“可 BWT 化的图”**；
- 在基因组图、文本合并图等应用中具备潜在的**低空间、快速查询**优势。

许多后续研究在探讨如何：

- **判定**一张图是否是 Wheeler Graph；
- **构造**相应顺序；
- **压缩**与**查询**算法；
- **动态 / 不完全 Wheeler** 场景。

总之，Wheeler Graph 的理念为“图上的 BWT索引”打开了大门，在大规模数据、基因组信息学、多文本检索等领域都具有相当深远的影响与应用潜力。
