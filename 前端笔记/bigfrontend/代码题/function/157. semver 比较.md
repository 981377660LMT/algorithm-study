http://github.com/npm/node-semver/blob/main/classes/semver.js

我们来详细讲解一下 `semver` 库中的 `compare` 函数。

你看到的是 `compare` 函数的 TypeScript 类型定义文件，它精确地描述了该函数的功能、参数和返回值。

### 核心功能

`compare` 函数的核心功能是比较两个遵循 [语义化版本（Semantic Versioning）](https://semver.org/lang/zh-CN/) 规范的版本号，并确定它们之间的大小关系。

这个函数在需要对版本进行排序、检查更新或执行基于版本的逻辑时非常有用。

### 函数详解

#### 1. 函数签名

```typescript
declare function compare(
  v1: string | SemVer,
  v2: string | SemVer,
  optionsOrLoose?: boolean | semver.Options
): 1 | 0 | -1
```

#### 2. 参数 (Parameters)

- `v1: string | SemVer`

  - **说明**: 第一个要比较的版本号。
  - **类型**: 它可以是一个版本字符串（如 `'1.2.3'`)，也可以是一个 `SemVer` 对象（通过 `new semver.SemVer('1.2.3')` 创建）。

- `v2: string | SemVer`

  - **说明**: 第二个要比较的版本号。
  - **类型**: 与 `v1` 相同。

- `optionsOrLoose?: boolean | semver.Options` (可选)
  - **说明**: 这是一个可选参数，用于控制版本号的解析方式。通常用作“宽松模式”开关。
  - **类型**:
    - `boolean`: 如果传入 `true`，解析器会以一种更宽松的模式工作，尝试解析一些不完全符合规范的版本字符串（例如，`'v1.2.3'` 或 `'=1.2.3'`）。
    - `semver.Options`: 一个更详细的配置对象，例如 `{ loose: true }`。

#### 3. 返回值 (Return Value)

`compare` 函数的返回值是一个数字，表示两个版本的比较结果：

- `1`: 如果 `v1` **大于** `v2`。
- `0`: 如果 `v1` **等于** `v2`。
- `-1`: 如果 `v1` **小于** `v2`。

这种 `(1, 0, -1)` 的返回值设计非常标准，可以直接用于数组的 `sort` 方法。

#### 4. 比较规则

- **主要版本号 > 次要版本号 > 修订号**: 比较从左到右进行。例如，`2.0.0` > `1.9.9`。
- **预发布版本**: 带有预发布标签（如 `1.0.0-alpha`, `1.0.0-beta.2`）的版本被认为比没有预发布标签的“正常”版本要**小**。例如，`1.0.0` > `1.0.0-rc.1`。
- **忽略构建元数据**: 比较时会完全忽略版本号中 `+` 后面的构建元数据（Build Metadata）。例如，`compare('1.2.3+build.1', '1.2.3+build.99')` 的结果是 `0`，因为它们在版本比较上是相等的。

### 使用示例

```javascript
import { compare } from 'semver'

// v1 < v2
console.log(compare('1.2.3', '1.2.4')) // 输出: -1

// v1 > v2
console.log(compare('2.0.0', '1.9.9')) // 输出: 1

// v1 == v2
console.log(compare('1.5.0', '1.5.0')) // 输出: 0

// 预发布版本比较
console.log(compare('1.0.0-alpha', '1.0.0')) // 输出: -1

// 忽略构建元数据
console.log(compare('1.2.3+20130313144700', '1.2.3+20241118100000')) // 输出: 0

// 用于数组排序
const versions = ['1.10.3', '2.0.0', '1.2.0', '0.1.0', '1.10.2']
versions.sort(compare)
console.log(versions)
// 输出 (升序): ['0.1.0', '1.2.0', '1.10.2', '1.10.3', '2.0.0']
```

总结来说，`semver.compare` 是一个强大而直接的工具，用于以可靠和标准化的方式处理软件版本号的比较和排序。
