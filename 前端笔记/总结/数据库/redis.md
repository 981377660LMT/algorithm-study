## redis 为什么快

Redis 为什么快，为什么单线程
首先，采用了多路复用阻塞 io 机制;
然后，数据结构简单，操作节省时间;
最后，运行在内存中，自然速度快
单线程：Redis 的瓶颈不是 cpu 的运行速度，而往往是网络带宽和机器的内存大小。单线程切换开销小，容易实现。

1.  Redis 是 Remote Dictionary Server(远程字典服务器)的缩写
2.  作用：缓存/队列(列表)/发布订阅(聊天室)
3.  特点：读写高性能；持久化；单线程；数据自动过期；发布订阅；分布式
4.  应用场景
    - 缓存系统(键过期)
    - 排行榜(zset 有序集合 ZADD ZRANGE ZRANK)/微博热搜(存帖子 id 和回复量就可以了)
    - 计数器(incr 命令，内存操作)
    - 分布式会话(session 服务)
    - 分布式锁(setnx 返回 1 获取锁成功，否则失败)
    - 社交网络(哈希；集合)
    - 最新列表(LPUSH 命令)
    - 消息系统()
5.  秒杀与 redis 的结合
    秒杀出现的问题:
    1. 并发太高导致程序阻塞
    2. 库存无法有效控制，出现超买
       对应解决方案
    3. 数据尽量缓存，阻断直接访问数据库
    4. 锁来控制超卖现象
       那么 redis 应该如何操作呢？
       1. 提前预热数据放入 redis
       2. 商品列表放入 redis list
       3. 详细数据放入 redis hash 设置过期时间
       4. 库存数据用 redis SortedSet 保存
       5. 用户地址用 redis set 保存
       6. 订单扣库存通过 redis 制造分布式锁，库存同步扣除
       7. 订单产生后发货的数据产生 redis list,通过消息队列处理
       8. 秒杀结束后同步 redis 与数据库
6.  redis-server 与 redis-cli
    ping pong
7.  redis 的多数据库 (默认 16 个，名称为编号命名;类似于命名空间而非独立的数据库)
    自动选择 0 号数据库
    不同的应用应该使用不同的 redis 实例(再开一个)

8.  | RDB 持久化与 AOF 持久化 |                              |
    | :---------------------- | ---------------------------- | -------- |
    | 持久化方式              | 优点                         | 缺点     |
    | RDB                     | 文件小；异步备份；恢复速度快 | 安全性低 |
    | AOF                     | 安全；利于开发分析异步       | 同步慢   |

    RDB:异步备份，将数据库的快照（`snapshot`）以二进制的方式保存到磁盘中
    AOF：将 redis **每一句命令 append 到文件**；同步；最安全，以协议文本的方式，将所有对数据库进行过写入的命令（及其参数）记录到 AOF 文件(`即记录 action`)
