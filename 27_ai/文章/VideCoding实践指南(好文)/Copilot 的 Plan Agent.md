### 1. 核心定位：专注于“谋划”而非“执行”

Plan Agent 的核心价值在于**将设计与实现分离**。它的唯一职责是产生一份详尽、可操作的实施方案，而不是直接修改代码。

- **防止盲目编码**：在复杂需求中，直接开始写代码容易忽略边界情况或架构影响。Plan Agent 通过强制规划阶段来规避风险。
- **零副作用**：根据规则（Rules），它被显式禁止使用文件编辑工具，这保证了其在研究阶段的安全性。

### 2. 工作流深度解析

Plan Agent 采用了一种非线性的迭代工作流，分为四个关键阶段：

#### ① 探索 (Discovery) —— 自动化研究

它是通过调用 `runSubagent`（子代理）来工作的。

- **自主性**：子代理会利用 `search`、`read`、`web` 等工具在代码库中横向和纵向穿梭，识别潜在的阻碍点、依赖关系或技术未知数。
- **非草率性**：在这一步，它被要求禁止起草完整计划，重点仅在于“挖深”和“找坑”。

#### ② 对齐 (Alignment) —— 确认意图

这是人机协作的关键点。

- **主动询问**：它被鼓励频繁使用 `askQuestions` 工具。如果发现技术规范不一致或需求模糊，它会主动向用户求证，而不是盲目猜测默认方案。

#### ③ 设计 (Design) —— 标准化输出

一旦背景清晰，它会按照严格的 `plan_style_guide` 生成计划。

- **可链接化**：要求使用 `[file](path)` 格式链接到具体文件，提供极高的可追溯性。
- **无代码原则**：计划中**不包含代码块**，只描述逻辑和变更，这使得计划更易于在高层级进行评审。

#### ④ 磨炼 (Refinement) —— 持续优化

它不是一锤子买卖。根据用户反馈（如“想看另一种实现方案”），它会回退到“探索”阶段重新审视。直到用户提供显式批准。

### 3. 工具箱与能力边界

Plan Agent 拥有强大的辅助工具，但缺乏直接的“破坏力”：

- **高级读能力**：支持读取 GitHub Issue、抓取网页、分析终端错误输出。
- **无写能力**：它没有 `replace_string_in_file` 或 `create_file` 等直接修改文件的权限（或被规则明确禁用）。
- **移交机制 (Handoff)**：
  - **Start Implementation**：将定稿的计划交给执行 Agent（如开发 Agent）去具体落实。
  - **Open in Editor**：将计划导出为 Markdown 文件，供开发者手动微调或存档。

### 4. 独特的风格指南 (Plan Style Guide)

Plan Agent 生成的每一份计划都包含四个标准板块：

- **TL;DR**：简述“做什么、怎么做、为什么”。
- **Steps**：步骤详尽到符号级引用（如具体类名 `symbol`）。
- **Verification**：明确告知如何验证（命令、测试用例等）。
- **Decisions**：记录关键的技术决策（例如：为什么选 A 而不是 B），这对于后期代码审查至关重要。

### 总结

**Plan Agent** 是一个架构师角色的 AI。它通过**子代理深度搜索**、**标准化文档输出**和**严格的职责限制**，确保在大规模代码修复或功能开发前，开发者能拿到一份“闭环、无歧义且经过验证”的蓝图。
