这篇文章是 Deep Research 复现系列的第二篇（中篇），核心议题从“如何搜索”转向了**“如何做得深（Deep）”**。作者以开源项目 **Jina** 为例，解构了如何通过 Agent 流程设计，让 AI 产出具有深度、洞察力和长篇幅的研究报告。

以下是对该文章核心技术逻辑的深度剖析：

### 1. 核心理念：什么是 "Deep"？

Deep Research 的目标不是快速回答，而是**高质量交付**。

- **标准**：篇幅充足（数千字 vs 寥寥数语）、描述具体且有洞察力（非泛泛而谈）、引用权威。
- **代价**：用户愿意等待 5-30 分钟，换取一份能带来“Aha Moment”的报告。
- **策略**：所有的 Prompt、工作流、微调都应围绕“增加深度”这一目标构建。

### 2. Jina 项目的架构解构

Jina 的实现介于“死板的工作流”和“纯端到端（End-to-End）”之间。它采用**动态循环机制**，由 LLM 根据上下文自主选择动作。

#### A. 准入机制：评估标准 (Evaluation Criteria)

在开始执行任务前，系统先确立“完成的标准”。

- **动态生成标准**：LLM 根据问题类型，从四个维度中选择标准：
  - **Definitive（明确性）**：拒绝模糊回答。
  - **Freshness（时效性）**：必须包含最新数据。
  - **Plurality（多样性）**：需要多个视角或案例。
  - **Completeness（完整性）**：覆盖问题的各个方面。
- **“拒绝一切”模式**：为了强制深度，可以设定系统一直拒绝生成的答案，直到 Token 预算耗尽。这迫使 Agent 不断优化和挖掘，直到最后一刻。

#### B. 核心循环：四大动作 (The 4 Actions)

系统在一个 Loop 中运行，LLM 基于当前上下文决定下一步执行哪个动作：

| 动作                  | 核心逻辑与技术细节                                                                                                                                                                                                                                                                                                                                                                                                       |
| :-------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **1. Search (搜索)**  | **不仅仅是查关键词**。<br>1. **发散**：生成多个 Search Query。<br>2. **改写**：根据初步结果，扮演“专家怀疑者”，改写 Query 以挖掘更深层信息。<br>3. **目的**：广泛收集信息线索 (URL, Title, Snippet)。                                                                                                                                                                                                                    |
| **2. Visit (阅读)**   | **深度阅读与清洗**。<br>1. **工具**：使用 `r.jina.ai` (ReaderLLM) 将 HTML 转为 Markdown。<br>2. **选文策略 (Heuristics)**：如何从海量搜索结果中选出最值得读的？<br>&nbsp;&nbsp;- **频率因子**：在多次搜索中重复出现的 URL 权重高。<br>&nbsp;&nbsp;- **域名/路径因子**：权威域名权重高。<br>&nbsp;&nbsp;- **语义重排序 (Rerank)**：使用 Embedding 模型计算内容与问题的相关性。<br>3. **目的**：获取精准、详实的全文内容。 |
| **3. Reflect (思考)** | **发现知识缺口 (Gaps)**。<br>1. **区分**：Reflect 产生的“子问题”不同于“搜索词”。子问题是需要被研究的课题。<br>2. **机制**：维护一个 `gaps` 列表，识别当前已知信息和目标之间的差距。<br>3. **目的**：驱动 Agent 跳出当前思维，寻找新的切入点。                                                                                                                                                                            |
| **4. Answer (回答)**  | **尝试交付**。<br>1. **生成**：基于所有收集到的 Context 生成回答。<br>2. **校验**：**这是关键一步**。生成的答案必须经过 Step A 中的“评估标准”检查。<br>3. **反馈**：如果未通过评估，失败原因会作为 Context 输入，强迫 Agent 继续 Search 或 Reflect。                                                                                                                                                                     |

#### C. 上下文管理 (Context Management)

由于不是一次性生成的长文本，Jina 通过多轮对话维护状态：

- **System Message**：存储先前步骤的摘要（Summary），保持宏观认知。
- **Knowledge Message**：存储每个动作（如 Visit 抓取的文章内容）产生的详细中间结果。
- **终止条件**：答案通过评估 OR Token 预算耗尽。

### 3. 技术洞见与总结

- **动态性胜过静态流**：Jina 没有规定 `Search -> Visit -> Answer` 的固定顺序。模型可能 `Search -> Reflect -> Search -> Visit -> Answer`。这种灵活性是应对复杂问题的关键。
- **Reflect 是深度的源泉**：没有 Reflect，Agent 只是一个高级搜索引擎。有了 Reflect，Agent 才能自我审视“我还缺什么信息”，从而产生多跳推理。
- **启发式算法辅助 LLM**：在 Visit 阶段，单纯靠 LLM 选择阅读哪些网页效率太低且昂贵。引入传统的加权算法（频率、域名）配合 Rerank 模型，是工程落地的优秀实践。

### 4. 复现建议

如果你想复现 Deep Research，文章建议参考 Jina 的 Python 复现版（`python-node-deepresearch`），并重点关注：

1.  **Prompt 工程**：特别是“评估标准”和“Query 改写”的 Prompt。
2.  **选文算法**：实现一套加权机制来筛选高质量 URL。
3.  **状态机设计**：构建一个允许 LLM 自由跳转状态的循环系统，而不是线性链。
