这份文档详细介绍了 **Deep Agents** 作为 "Agent Harness"（智能体装备/线束）的核心能力。它在标准的 Agent 工具调用循环基础上，集成了一系列增强功能，以支持复杂任务的执行和管理。

以下是主要能力总结：

### 1. 文件系统与存储架构
*   **文件操作工具**: 提供 `ls`, `read_file`, `write_file`, `edit_file`, `glob`, `grep` 六大工具，使文件操作成为 Agent 的核心能力。
*   **可插拔存储后端**: 支持多种存储策略以适应不同场景：
    *   **StateBackend**: 内存级临时存储（随线程状态保存）。
    *   **FilesystemBackend**: 真实磁盘访问（支持沙盒模式）。
    *   **StoreBackend**: 基于 LangGraph Store 的跨对话持久化存储。
    *   **CompositeBackend**: 支持混合路由，将不同路径映射到不同后端。

### 2. 上下文优化与内存管理
*   **大结果自动驱逐 (Eviction)**: 当工具返回结果超过阈值（默认 **20,000 tokens**）时，`自动将其转存为文件并仅返回引用`，防止上下文窗口溢出。
*   **历史记录总结**: 当 **Token 使用量过高（>170,000）时**，自动总结旧的对话历史，仅保留最近的 6 条消息。
*   **Prompt Caching**: 针对 Anthropic 模型启用缓存，显著降低长 System Prompt 的延迟和成本。

### 3. 任务委派与规划
*   **子智能体 (Subagents)**: 允许主 Agent 创建临时的、上下文隔离的子 Agent。这有助于并行执行任务，并防止子任务的详细日志污染主 Agent 的上下文。
*   **任务追踪**: 内置 `write_todos` 工具，用于维护结构化的任务列表和状态（待处理/进行中/已完成）。

### 4. 鲁棒性与控制
*   **悬空调用修复**: 自动检测并修复因中断或取消导致的“悬空”工具调用（即没有返回结果的调用），确保消息历史的连贯性。
*   **人在回路 (Human-in-the-Loop)**: 可配置特定工具（如 `edit_file`）在执行前暂停，强制要求人工批准或修改输入。