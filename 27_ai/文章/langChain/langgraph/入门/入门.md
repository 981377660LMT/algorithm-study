这份文档是 **LangGraph 的快速入门指南**，演示了如何构建一个具备加减乘除功能的“计算器 Agent”。

文档提供了两种构建方式：**Graph API (图 API)** 和 **Functional API (函数式 API)**。

以下是核心步骤和概念的总结：

### 准备工作
*   你需要一个 Anthropic 的 API Key，并设置环境变量 `ANTHROPIC_API_KEY`。
*   示例使用的是 `claude-sonnet-4-5-20250929` 模型。

---

### 方式一：使用 Graph API
这种方式通过定义节点（Nodes）和边（Edges）来构建 Agent，适合结构化、可视化的工作流。

1.  **定义工具和模型**：
    *   使用 Zod 定义 `add`, `multiply`, `divide` 工具。
    *   初始化 ChatAnthropic 模型并绑定这些工具 (`bindTools`)。
2.  **定义状态 (State)**：
    *   使用 Zod 定义图的状态结构 `MessagesState`。
    *   包含 `messages`（消息列表）和 `llmCalls`（调用计数）。
3.  **定义节点 (Nodes)**：
    *   **Model Node (`llmCall`)**：调用 LLM，返回新的消息。
    *   **Tool Node (`toolNode`)**：检查最后一条消息中的工具调用，执行工具并返回结果。
4.  **定义逻辑 (Edges)**：
    *   **条件边 (`shouldContinue`)**：判断 LLM 是否请求了工具调用。如果有，路由到 `toolNode`；否则，路由到 `END` 结束。
5.  **构建与编译**：
    *   使用 `StateGraph` 初始化图。
    *   添加节点和边（`START` -> `llmCall` <-> `toolNode`）。
    *   调用 `.compile()` 生成可运行的 Agent。

---

### 方式二：使用 Functional API
这种方式通过编写标准的函数来定义 Agent，适合偏好代码逻辑而非图结构的开发者。

1.  **定义工具和模型**：与 Graph API 相同。
2.  **定义任务 (Tasks)**：
    *   使用 `task` 包装器定义原子操作。
    *   `callLlm`：调用模型。
    *   `callTool`：执行具体的工具调用。
3.  **定义 Agent (Entrypoint)**：
    *   使用 `entrypoint` 定义主流程函数。
    *   在函数内部使用标准的 `while` 循环和 `if` 判断来管理流程：
        *   调用 LLM。
        *   检查是否有工具调用。
        *   如果有，执行工具并将结果添加到消息历史 (`addMessages`)。
        *   循环直到完成。

### 总结
*   **Graph API**：显式定义状态机，适合复杂的状态管理和可视化。
*   **Functional API**：更像编写普通的异步函数，代码结构更直观，适合简单的循环模式。