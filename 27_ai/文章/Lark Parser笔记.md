# LarkParser(LarkDoc2Markdown Parser) 解析飞书文档

## What

让飞书文档为 Agent 所用：飞书文档（Docx / Sheet / Bitable / Wiki）统一解析SDK，将飞书文档转换为 AI 可消费的 Markdown。支持
45+ 内容块类型，通过 LLM 增强图片、表格、画板的语义理解。

https://9ru8mavv.fn.bytedance.net/

## Why

飞书文档承载了大量知识沉淀——会议纪要、产品方案、技术设计、数据报告, 但当我们构建 RAG 系统或让 Agent 处理这些文档时
面临三个核心痛点：

- API 繁琐：飞书文档(docx)、表格(Sheet)、多维表格(Bitable) 各有不同 API 和数据结构, 完成解析需要10+ API且API之间存在不同的限流额度.
- 内容丢失：图片、表格、画板等富文本元素在解析中常被忽略
- 语义缺失：AI 只能看到"一张图"或"一个表"，无法理解其内容

Lark Parser 提供统一的飞书文档解析 SDK，可将文档转换为对 AI 友好的 Markdown 文本。依托大语言模型和多模态技术，Lark Parser 还具备对文档中的图片、画板、表格等进行语义理解及增强的功能。

## How

- AI 增强解析
  - 图片 Caption：让每一张图都参与对话
    痛点：文档中的图片（如架构图、流程截图）往往是信息孤岛，无法通过文本关键词被检索到。
    解决方案：当开启 enable_image_caption=True 时，Lark Parser 会调用大模型，为文档中的每一张图片自动生成一段描述性文本（Caption）。这段文本会作为图片的 alt text 嵌入 Markdown 中。
  - 表格表头识别：让无结构数据变得规整
    痛点：飞书表格无法设置表头, 给下游的结构化数据提取和 RAG Chunk 带来了巨大困扰。
    解决方案：启用 enable_table_header_extract=True 后，Lark Parser 会截取表格的前几行，利用 LLM 的理解能力，智能判断哪几行是表头，并将其余部分作为数据行。
  - 飞书画板 → Mermaid：为 Agent 打开“视界”
    痛点：飞书画板是表达复杂逻辑（如流程图、架构图、UML）的利器，但对于 Agent 来说，画板就是一张无法理解的图片，阻碍了其进行后续的分析、修改或执行。
    解决方案：我们将画板的节点和连接关系数据，映射为结构化的 Mermaid 代码。Mermaid 是一种用文本描述图表的语言，天然适合 Agent 理解和再创作。

- Agent 友好输出（mermaid）：按需选择输出形态
  - Agent/RAG 场景：输出为 Agent 可读、可编辑的 Mermaid 代码块，便于进行二次分析和加工。
  - 纯展示/存档场景：将画板渲染成一张 Base64 图片作为附件，保证视觉上的“所见即所得”。

- 解析模式(fast、retry、strict)：按需选择解析速度与准确率
  从 retry 模式开始。如果发现响应时间不满足要求，切换到 fast。如果绝对不能容忍任何数据丢失，选择 strict。
- 轻量级 SDK、功能增强的半托管、生产级零运维的全托管、MCP

  为了适应从本地开发到大规模生产的不同需求，Lark Parser 提供了三种灵活的服务形态。对于小流量情况（一般单机器人小于 5 QPS），SDK 可以很好地解决；若需要更快的访问性能和更高的 QPS，建议考虑「半托管/全托管」。

  | 服务形态             | 核心优势                                                                                 | 适用场景                                                | 如何获取                            |
  | :------------------- | :--------------------------------------------------------------------------------------- | :------------------------------------------------------ | :---------------------------------- |
  | **SDK**              | **轻量、零依赖**：`pip install` 即可用，适合本地开发和快速原型验证。                     | 个人脚本、小型项目、功能验证、Agent Tool Use。          | `pip install bytedance.lark_parser` |
  | **半托管**           | **性能增强**：提供缓存加速、图片持久化存储和更高的 QPS 支持，AI 功能默认开启。           | 对性能和稳定性有一定要求的内部服务或中型项目。          | -                                   |
  | **全托管 (AGI Hub)** | **生产级、零运维**：享受自动扩缩容、高可用保障，所有高级功能默认启用，无需关心底层部署。 | 面向大规模用户、高并发的核心业务，如公司级的 RAG 服务。 | -                                   |
  | **MCP**              | **Agent 友好**：同时享受半托管及以上服务待遇。                                           | 面向 Agent 开发者                                       | -                                   |
