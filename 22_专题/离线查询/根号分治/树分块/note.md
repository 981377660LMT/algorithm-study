https://www.cnblogs.com/IzayoiMiku/p/14691521.html
https://www.luogu.com.cn/blog/gxy001/shu-fen-kuai-xue-xi-bi-ji
https://www.cnblogs.com/hua-dong/p/8275227.html

大部分时候，树上问题是由树剖，LCT，树分治来解决。但在某些情况下，树分块也是一种选择。
和序列分块一样，树分块也是一种暴力。大致思想仍是将将树按“某种思路”划分进数个块中，然后维护块内整体信息的算法。

树上的有些问题是可以用树剖或者动态树解决的，但是他们有一个共同点就是：**不连通。**
比如求 u 到 v 的路径权值和，或者最大值：
u 到 v 可能对应了多个链，这多个链在对应的数据结构（假设是线段树）上面对应不同的区间。但是线段树上这几个区间的不连续并不影响我们得到答案。(当然求子树的信息话是连续区间)
那么如果我们遇到的问题要求区间连续呢，`比如求 u 到 v 的路径上点的权值有多少种`？如果不连续就得处理链与链之间的关系。**显然这些点得待在一起，如果树剖很难维护链与链之间的关系。**

---

`王室联邦树分块法(基于连通性的树分块)`：
分块方式:满足每块大小在 [B,3B]，块内每个点到核心点路径上的所有点都在块内(`除开核心点`，核心点可以在块内也可以在块外).
**但是不保证每个块都是连通的.**这样分块是为了莫队的排序，而不是预处理保存信息。

`树上撒点树分块法`：
设置一个阈值 S，随机找 n/S 个关键点，使得每个关键点到离它最近的祖先关键点的距离不超过 S。对于所有点找到它的第一个关键祖先，将它和关键祖先分为一块。
**可以保证块联通，期望直径长度为 S，块大小为 n/S，但是常数较大。**

`基于深度的树分块`
![https://www.zhihu.com/question/60674478/answer/178873326](image.png)

在 2013 年的某篇有关分块介绍了这样一种：**设 H=int(sqrt(n))，如果 i 的深度是 H 的倍数且 i 子树大小不小于 H，那么就把 i 标记为关键点。可以证明这样也有总数 sqrt(n)和路径上 2sqrt(n)就至少碰到一个的性质。**

---

最终选择：
**重链分块**
轻重链剖分，由于重链上的点的 dfn 序是连续的，序列分块即可；每次询问，跳重链分块计算这条重链的贡献
