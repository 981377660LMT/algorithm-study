## persistence (持久性)

35. Dialogue
    让信息持久，尽管计算机会崩溃，磁盘会出故障或停电，这是一项艰巨而有趣的挑战
36. I/O Devices (I/O 设备)

## I/O 应该如何集成进系统中？其中的一般机制是什么？如何让它们变得高效？

![alt text](image-4.png)
分层架构：因为物理布局及造价成本，越快的总线越短
要求高性能的设备（比如显卡）离 CPU 更近一些，低性能的设备离 CPU 远一些
将磁盘和其他低速设备连到外围总线的好处很多，其中较为突出的好处就是你可以在外围总线上连接大量的设备。

## 操作系统检查设备状态时如何避免频繁轮询，从而降低管理设备的 CPU 开销？

- 利用中断减少 CPU 开销
  当设备完成了自身操作，会抛出一个硬件中断，引发 CPU 跳转执行操作系统预先定义好的中断服务例程（Interrupt Service Routine，ISR），或更为简单的中断处理程序（interrupt handler）。

37. Hard Disk Drives (硬盘驱动器)

现代磁盘驱动器如何存储数据？接口是什么？数据是如何安排和访问的？磁盘调度如何提高性能？

38. Redundant Disk Arrays (RAID，冗余磁盘阵列)

我们如何构建一个大型、快速和可靠的存储系统？关键技术是什么？不同方法之间的折中是什么？

39. Files and Directories (文件和目录)

内存在断电时，其内容会丢失，而持久存储设备会保持这些数据不变。因此，操作系统必须特别注意
这样的设备：用户用它们保存真正关心的数据。

40. File System Implementation (文件系统实现)
    每个文件（元数据）的一些信息，这通常存储在名为 inode 的结构中。目录只是“存储名称→inode 号”映射的特定类型的文件。其他结构也是需要的。例如，文件系统通常使用诸如位图的结构，来记录哪些 inode 或数据块是空闲的或已分配的。
41. Fast File System (FFS) (快速文件系统)

42. FSCK and Journaling (文件系统检查和日志)

文件系统面临的一个主要挑战在于，如何在出现断电（power loss）或系统崩溃（system crash）的情况下，更新持久数据结构。

- 崩溃一致性问题（crash-consistency problem）。

崩溃一致性问题是指在系统崩溃或意外中断时，数据的一致性无法得到保证的问题。
这通常发生在数据写入过程中，如果系统在写入操作完成之前崩溃，可能会导致数据部分写入或数据损坏，从而使系统处于不一致的状态。
解决崩溃一致性问题的方法包括使用`事务、日志记录和检查点`等技术，以确保在系统恢复时能够回滚到一致的状态。

43. Log-Structured File System (LFS) (日志结构文件系统)

44. Data Integrity and Protection (数据完整性和保护)

45. Summary

46. Dialogue(关于分布式的对话)

构建分布式系统很难，因为事情总是会失败。
消息会丢失，机器会故障，磁盘会损坏数据，就像整个世界都在和你作对。

47. Distributed Systems (分布式系统)

`如何构建在组件故障时仍能工作的系统`
如何用无法一直正常工作的部件，来构建能工作系统？这个基本问题应该让你想起，我们在 RAID存储阵列中讨论的一些主题。然而，这里的问题往往更复杂，解决方案也是如此。

### 通信基础

`通信本身是不可靠的`
丢包是网络的基本现象。所以问题变成：应该如何处理丢包？
ack+超时/重试+自增序列号+校验和

48. Network File System (NFS) (网络文件系统)

客户端/服务器分布式文件系统中两个最重要的软件部分：`客户端文件系统和文件服务器`。
它们的行为共同决定了分布式文件系统的行为

- 服务器的故障要能简单快速地恢复：无状态协议，服务器不会追踪每个客户端发生的事情。
- 如何定义无状态文件协议( NFSv2 协议)?客户端使用文件句柄来标识文件和目录，文件句柄在服务器端是唯一的。
- 利用幂等操作处理服务器故障
- 提高性能：客户端缓存
- 缓存一致性问题

49. Andrew File System (AFS) (安德鲁文件系统)

50. Summary

## appendices

- Virtual Machines

- Monitors

- Lab Tutorial

- Systems Labs

- xv6 Labs
