# 中心化与去中心化架构

本节课主要讨论 Agent 之间的通信方式与系统架构。因为在 Multi-Agent 问题中，一个 Agent 的策略和动作会影响其他所有 Agent，所以单纯使用 Single-Agent 方法（完全孤立）效果通常不好。

系统通常假设 **Partial Observation (不完全观测)**：Agent $i$ 只能看到局部的状态 $o_i$，而不一定能看到全局状态 $s$。

---

## 1. 三种常见的系统架构

### 1.1 完全去中心化 (Fully Decentralized)

- **训练与执行**：每个 Agent 都是独立的个体。
- **特点**：
  - 每个 Agent 独立与环境交互。
  - 仅使用**自己在本地的局部**观测 ($o_i$) 和奖励 ($r_i$) 来更新自己的策略。
  - Agents 彼此**不交流**，不知道别人的观测和动作。
- **本质**：相当于把 n 个 Single-Agent RL 算法并行运行。
- **优缺点**：实现最简单，但通常效果不好，因为它忽略了 Agent 之间的相互影响（将其他 Agent 视为环境的一部分，导致环境不稳定）。

### 1.2 完全中心化 (Fully Centralized)

- **训练与执行**：所有信息汇总到**中央控制器 (Central Controller)**，由中央统一决策。
- **特点**：
  - **定于一尊**：Agents 自身没有策略网络，不做决策，只负责执行指令。
  - Agents 把所有观测汇报给中央。
  - 中央控制器收集所有 Agents 的观测、动作、奖励，拥有**全局信息**。
  - 中央“亲自部署、亲自指挥”，告诉每个 Agent 该做什么 ($a_i$)。
- **优缺点**：
  - **优点**：拥有全局信息，能做出全局最优决策。
  - **缺点**：**执行速度慢**。需要通信 (Communication) 和同步 (Synchronization)，所有 Agent 都要等待最慢的一个，无法做到实时决策。

### 1.3 中心化训练，去中心化执行 (Centralized Training with Decentralized Execution, CTDE)

这是目前 MARL 中最流行的架构。

- **执行阶段 (Decentralized)**：
  - 每个 Agent $i$ 拥有独立的**策略网络 (Actor)** $\pi(o_i; \theta_i)$。
  - Agent 仅根据自己的**局部观测** $o_i$ 做出决策 $a_i$，不需要与中央通信，也能独立行动。
- **训练阶段 (Centralized)**：
  - 引入一个**中央控制器 (Critic/Value Network)**。
  - 中央控制器拥有 $n$ 个价值网络 $Q_i(o, a; w_i)$（或者一个共享的 $Q$）。
  - **关键点**：Critic 的输入包含**所有 Agents 的观测 $O=\{o_1, ..., o_n\}$ 和动作 $A=\{a_1, ..., a_n\}$**。
  - Critic 利用全局信息来评价 Agent 的动作，指导 Agent 改进策略。
- **总结**：训练时利用全局信息（上帝视角）让 Agent 学得更好；训练结束后，Agent 即使没有上帝视角也能独立表现出色。

---

## 2. 参数共享 (Parameter Sharing)

在多智能体系统中，是否让所有 Agents 共享同一套网络参数？

- **取决于具体应用场景**：
  - **不共享**：如果 Agents 功能不同。
    - 例如：**机器人足球**。有的负责进攻，有的负责防守，有的守门。功能不同，网络参数不应相同。
  - **共享**：如果 Agents 同质且功能一致。
    - 例如：**无人机编队/无人车**。如果是相同型号、执行相同性质的任务，可以共享参数，提高训练效率。

---

## 3. 架构对比总结

| 架构                    | 谁做决策 (Actor) | 谁做评价 (Critic) | 信息视角               | 适用性                                     |
| :---------------------- | :--------------- | :---------------- | :--------------------- | :----------------------------------------- |
| **Fully Decentralized** | 本地             | 本地              | 局部观测               | 简单基线，但在复杂交互中效果差             |
| **Fully Centralized**   | 中央             | 中央              | 全局信息               | 决策质量高，但通信延迟高，难以实时         |
| **CTDE**                | 本地             | 中央 (仅训练时)   | 训练看全局，执行看局部 | 兼顾了训练的准确性和执行的实时性，当前主流 |
