# 搜索引擎技术深度分析（四）：核心排序特征与个性化 CTR 预估

本阶段分析涵盖了第 7、8、9、10 章节，重点探讨了在满足相关性（Relevance）之后，如何通过**内容质量、时效性、地域性**以及**个性化点击率（CTR）**这四大支柱，实现最终搜索结果的精细化排序。

---

## 1. 内容质量（Content Quality）：建立信任的基础

如果说相关性是“底线”，那么内容质量就是“红线”。

### 1.1 EAT 准则

- **Expertise (专业性)**：作者是否有资质（如医疗建议必须由医生撰写）。
- **Authoritativeness (权威性)**：来源是否可靠（官网、认证机构 vs. 搬运号）。
- **Trustworthiness (可信赖)**：是否存在诱导点击、虚假测评或黑产嫌疑。
- **YMYL 领域**：在金钱、医疗、法律、新闻（Your Money Your Life）领域，EAT 分数具有一票否决权或极高权重。

### 1.2 质量评估维度

- **意图判断**：打击有害信息（散布仇恨、诈骗），扶持有益信息（干货、攻略）。
- **文本/画质评估**：利用 BERT 理解深度，利用 CNN/ViT 对图片做美学评分、景深判断及反滤镜（针对过度滤镜的降权）。

---

## 2. 时效性（Timeliness）：快与新的博弈

时效性不仅是文档的“年龄”，更是对查询意图的精准捕捉。

### 2.1 时效性意图分类

1.  **突发时效性**：突发热点（如：科比、世界杯热赛）。无法仅通过语义模型判断，必须结合**数据挖掘**（搜索量突增、站外热榜）。
2.  **一般时效性**：显式（带有“最新”）或隐式（“交规”、“核酸政策”）。根据诉求强度分为强、中、弱。
3.  **周期时效性**：如“春晚”、“双十一”。

### 2.2 链路承接

- **新文档索引**：为承接强时效意图，召回阶段必须有独立的新文档索引（24h/7d），避免被高相关度的老文档挤掉。
- **排序加权**：根据意图强度动态调整文档年龄（Document Age）的权重。

---

## 3. 地域性（Locality）：本地内容搜索

解决“我在上海搜火锅，你给我出北京探店”的问题。

### 3.1 意图细分

- **附近意图（Distance Sensitive）**：对距离极度敏感，通常为 5km 以内的 POI。
- **同城意图（City Level）**：对距离不敏感，但必须限制在同城（如：周边游、租房）。

### 3.2 排序策略：价值与距离的融合

- **难点**：距离和 Reward（相关性/质量分）量纲不同。
- **解决方案**：基于**距离的序（Rank）**进行融合。
  $$Score_i = \lambda \cdot Reward_i + (1-\lambda) \cdot \frac{1+\beta}{Rank_i^\alpha + \beta}$$
  该公式利用排名而非物理距离数值，消除了不同场景下距离尺度的影响。

---

## 4. 个性化与 CTR 预估：搜索的“读心术”

点击率模型利用海量用户行为（点击、交互、转发）来纠正文本语义模型的偏差。

### 4.1 特征工程

- **后验统计特征**：查询词-文档（Q-D）的统计 CTR 是最重要特征，代表了群体智慧的投票。
- **用户行为序列**：最近搜索过的 Q、点击过的 D。建模手段包括 Average Pooling、**DIN (Deep Interest Network)** 以及用于长序列的 **SIM**。

### 4.2 模型演进：从单目标到多目标

- **MMoE (Multi-gate Mixture-of-Experts)**：
  - **作用**：同时预估点击、点赞、收藏、完播等多个目标。
  - **优势**：通过 Gate 机制平衡不同目标间的共性与特性，避免单一目标导致的内容“标题党”化。
- **双塔模型（后期融合）**：用于召回/粗排，通过 $Sigmoid(x^T z)$ 快速计算，支持海量候选集。

---

## 5. 核心洞察

1.  **搜索 vs. 推荐的差异**：在推荐中，CTR 模型起决定性作用；在搜索中，相关性是首要条件，CTR 只是在此基础上的“调味剂”和“校准器”。
2.  **负采样校准**：线上推理必须反映各档位的真实概率。对由于训练降采样导致的模型高估，需通过 Logit 校准：$x_{true} = x_{pred} + \ln \alpha$ （$\alpha$ 为降采样率）。
3.  **统计特征的局限性**：QD 统计特征虽然强，但对新文档（New Document）极度不友好，模型需要平衡“利用”与“探索”。

---

_下一阶段将分析：排序阶段的基本原理（海选/粗排/精排）及其融合模型（GBDT 等）的训练。_
