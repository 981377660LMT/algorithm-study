这节课继续讲解物品冷启的召回。聚类召回是基于物品内容的召回通道。它假设如果用户喜欢一个物品，那么用户会喜欢内容相似的其他物品。使用聚类召回，**需要事先训练一个多模态神经网络，将笔记图文表征为向量，并对向量做聚类，然后建索引**。

---

这节课介绍了物品冷启动中一种非常高效且具有**内容感知能力**的召回策略 —— **聚类召回 (Cluster-based Recall)**。

相比于简单的类目召回（太粗糙）和 Look-alike（后面会讲，偏重人群），聚类召回的核心思想是：**“物以类聚”，通过内容理解算法将海量笔记划分成精细的小圈子（Cluster），如果用户喜欢这个圈子里的老内容，就把圈子里刚发布的新内容推给他。**

以下是对这节课内容的深度逻辑拆解与总结：

### 1. 核心逻辑与工作流程

聚类召回本质上是一种 **基于内容相似度 (Content-based Similarity)** 的召回方法，但通过聚类提高了检索效率。

#### Step 1: 离线索引构建 (Offline Indexing)

1.  **向量化**：新笔记发布后，立刻通过一个**多模态神经网络**（包含 CNN 处理图片，BERT 处理文本），将其转化为一个特征向量 (Embedding)。
2.  **聚类判定**：计算这个向量与预先训练好的 **$K$ 个聚类中心 (Cluster Centroids)** 的距离（通常 $K \approx 1000$）。
3.  **归 堆**：找到最相似的那个 Cluster（比如 Cluster #500 是“上海买房攻略”）。
4.  **入库**：将新笔记的 ID 加入该 Cluster 对应的**倒排链表**中。
    - _重要细节_：链表按**发布时间倒排**，新的在最前面。

#### Step 2: 在线召回 (Online Retrieval)

1.  **获取种子 (Seeds)**：获取用户最近交互过（点赞、收藏）的 Last $N$ 篇笔记。
2.  **映射 Cluster**：算出这些种子笔记属于哪几个 Cluster。
3.  **截取新内容**：去这几个 Cluster 的倒排链表里，取出**最新发布**的 Top $M$ 篇笔记。
4.  **结果**：一共召回 $N \times M$ 篇候选笔记。

### 2. 核心组件：多模态内容理解网络

如何判断两篇笔记“内容相似”？不能靠人工，要靠模型。

- **模型架构**：双塔结构（或者叫 Siamese Network 孪生网络结构）。

  - **输入**：笔记 A（图+文），笔记 B（图+文）。
  - **特征提取**：
    - 图片 $\to$ CNN (ResNet 等) $\to$ 向量 $V_{img}$
    - 文本 $\to$ BERT $\to$ 向量 $V_{txt}$
    - 融合 $\to$ Concat / Attention $\to$ 全连接层 $\to$ **最终笔记 Embedding**
  - **输出**：两个 Embedding 的余弦相似度 (Cosine Similarity)。

- **训练目标**：让内容相似的笔记向量距离近，不相似的远。
- **Loss Function**：Triplet Loss (三元组损失) 或 Log Loss。
  - 输入三元组：(种子笔记 $Q$, 正样本 $P$, 负样本 $N$)。
  - 目标：$Sim(Q, P) \uparrow, \quad Sim(Q, N) \downarrow$。

### 3. 数据样本构建 (难点)

模型训练的好坏，取决于样本选得好不好。

- **正样本 (Positive Samples) —— 谁和谁是相似的？**

  - _简单粗暴_：人工标注（太贵，不可行）。
  - _算法自动挖掘_：
    1.  **硬性过滤**：必须属于同一个二级类目（如都是“家常菜”）。
    2.  **ItemCF 验证**：利用**高曝光的老笔记**的历史数据。如果很多用户同时点了笔记 A 和笔记 B，说明它们在语义上高度相似。
    - _逻辑闭环_：用`老笔记成熟的行为数据训练模型`，让模型学会“什么是相似”，然后用这个模型去推断刚发布的新笔记。

- **负样本 (Negative Samples) —— 谁和谁是不相似的？**
  - 随机采样即可。
  - _筛选条件_：为了保证训练效果，负样本最好选那些内容丰富（字多）、质量高的笔记，避免选到垃圾笔记干扰模型学习。

### 4. 优缺点分析

- **优点**：
  - **细粒度**：比“类目召回”准得多。类目只有几十个，Cluster 有上千个。用户看“上海买房”，类目召回可能推“北京租房”，但聚类召回能推“上海买房”。
  - **冷启动友好**：纯基于内容（Content-based），完全不需要新笔记有交互数据。
- **缺点**：
  - **时效性限制**：和类目召回一样，也是按时间倒排。笔记发布一两小时后，就会被挤出倒排链表的 Top $M$，失去召回机会。
  - **泛化性一般**：只能召回和历史行为**语义上相似**的东西，缺乏惊喜感和扩展性。

### 5. 总结

聚类召回是工业界解决冷启动问题的**中流砥柱**。它弥补了类目召回太泛、协同过滤无法冷启的缺陷。
通过**离线训练多模态模型 $\to$ 将内容映射到细分 Cluster $\to$ 在线基于最近行为检索 Cluster 最新内容**，实现了一套标准化的新物品分发流水线。
