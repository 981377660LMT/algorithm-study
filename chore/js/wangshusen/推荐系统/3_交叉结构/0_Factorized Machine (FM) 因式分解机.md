线性模型对输入的特征取加权和，作为对目标的预估。如果先做特征交叉，再用线性模型，通常可以取得更好的效果。
如果做二阶特征交叉，那么参数量为 O(特征数量平方)，计算量大，而且容易造成过拟合。因式分解机（Factorized Machine, FM）用低秩矩阵分解的方式降低参数量，加速计算。任何可以用线性模型（比如线性回归、逻辑回归）解决的问题，都可以用 FM 解决。

---

这节课的内容从线性模型切入，引出了工业界早期处理特征交叉的经典模型——**FM (Factorization Machine)**。虽然现在的深度学习模型（如 DeepFM, DCN）已经取代了原始 FM，但 FM 的思想是理解“`特征交叉`（Feature Interaction）”和“Embedding”的基石。

以下是详细的逻辑拆解与总结：

### 1. 核心动机：为什么要特征交叉？

- **线性模型 (Logistic Regression)** 的局限性：
  $$ y = b + \sum w_i x_i $$
  - 这是一个**“各论各的”**的模型。它认为每个特征独立影响结果。
  - _例子_：房价预测。如果只知道 `面积` 和 `单价`，线性模型可以分别学到“面积越大越贵”、“单价越高越贵”。但真实的房价是 `面积 × 单价`。线性模型如果不手动构造这个交叉特征，它是学不到这种乘法关系的。
- **二阶特征交叉 (Second-Order Interaction)**：
  $$ y = b + \sum w*i x_i + \sum \sum u*{ij} x_i x_j $$
  - 引入 $x_i x_j$ 项，让特征两两相乘。
  - _问题_：如果有 $d$ 个特征，这就需要 $d^2$ 个权重参数 $u_{ij}$。
  - _灾难_：在推荐系统中，One-Hot 编码后的特征维度 $d$ 往往是百万、千万级（比如 User ID）。那么 $d^2$ 就是天文数字 ($10^{14}$)，既存不下，也算不动，更因为数据稀疏根本训练不出来（过拟合）。

### 2. FM 的核心思想：矩阵分解（降维打击）

- **痛点**：权重矩阵 $U$ 太大了 ($d \times d$)，且非常稀疏。
- **解决方案**：假设矩阵 $U$ 是低秩的，可以分解为两个低维矩阵的乘积。
  $$ U \approx V V^T $$
  - $V$ 是一个 $d \times k$ 的矩阵，其中 $k \ll d$ （$k$ 通常取几十，如 32, 64）。
  - $U$ 中的每一个元素 $u_{ij}$ 被近似为：$u_{ij} \approx \vec{v}_i \cdot \vec{v}_j$。
- **物理意义**：
  - $\vec{v}_i$ 就是我们现在常说的 **Embedding 向量**。
  - FM 并没有给每一对 $(x_i, x_j)$ 单独学习一个权重，而是给每个特征 $x_i$ 学习了一个隐向量 $\vec{v}_i$。
  - 两个特征交叉的影响力权重，取决于它们隐向量的相似度（内积）。

### 3. FM 模型公式

$$ y = b + \sum*{i=1}^d w_i x_i + \sum*{i=1}^d \sum\_{j=i+1}^d (\vec{v}\_i \cdot \vec{v}\_j) x_i x_j $$

- **参数量**：
  - 直接交叉：$O(d^2)$。
  - FM：$O(d \times k)$。因为只需要存 $d$ 个长度为 $k$ 的向量。
  - 这是一个巨大的优化，使得千万级特征的二阶交叉成为可能。

### 4. 总结与评价

- **历史地位**：FM 是继 LR（逻辑回归）之后，推荐系统的一个里程碑。它自动化地解决了特征组合的问题，不再需要人工去手动做特征工程（比如手动把“啤酒”和“尿布”拼成一个特征）。
- **优点**：
  1.  **参数少**：将 $d^2$ 降维到 $dk$，解决了稀疏数据下的参数训练问题。
  2.  **泛化强**：即使某些特征组合 $(x_i, x_j)$ 在训练集中从未出现过，只要 $x_i$ 和别的特征出现过（学到了 $\vec{v}_i$），$x_j$ 和别的特征出现过（学到了 $\vec{v}_j$），模型就能预测它们的交叉效果 $\vec{v}_i \cdot \vec{v}_j$。
- **现状**：正如王树森老师所说，纯 FM 在现代大厂的核心排序中已较少直接使用，逐渐演变成了 DeepFM、NFM 等神经网络模型中的一个组件（Wide & Deep 里的 Wide 部分或者 Embedding 层后的 Product 层）。但它的**Embedding + 内积**思想，是所有现代推荐模型的鼻祖。
