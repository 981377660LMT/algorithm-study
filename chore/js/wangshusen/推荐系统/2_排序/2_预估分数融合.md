排序的多目标模型会预估点击率、点赞率等指标。得到这些指标之后，需要将它们融合成一个分数。这节课介绍工业界常用的几种融分公式。

---

这节课填补了排序模型的**“最后一公里”**：当我们通过 MMoE 等模型辛苦算出了点击率（CTR）、点赞率（CVR）、时长等一堆分数后，到底该怎么把它们捏合成一个最终的排序分（Final Score）？

这是一个**业务导向**极强的问题，没有标准答案，只有适合业务阶段的公式。王老师介绍了几种工业界经典的融分策略，以下是深度拆解：

### 1. 基础融合策略

#### A. 加权求和 (Weighted Sum)

- **公式**：$Score = P_{click} + w_1 \cdot P_{like} + w_2 \cdot P_{collect} + \dots$
- **逻辑**：最直观的方法。通过调整权重 $w$ 来控制不同指标的重要性。
- **缺点**：不同指标的量纲不同（点击率可能是 0.1，点赞率可能是 0.01），直接相加容易被大数值主导。

#### B. 概率连乘 (Probabilistic Product)

- **公式**：$Score = P_{click} \times (1 + w_1 \cdot P_{like} + w_2 \cdot P_{share} + \dots)$
- **逻辑**：**漏斗逻辑**。
  - 交互行为（点赞、评论）通常发生在点击之后。
  - $P_{click} \times P_{like}$ 本质上是在预估**“曝光后发生点赞的概率”**（期望点赞数）。
  - 这种公式比单纯加权和更符合用户行为的因果链条。

---

### 2. 进阶融合策略（大厂实战）

#### 案例一：海外短视频 APP (非线性乘积)

- **公式结构**：
  $$ Score = (1 + w*1 \cdot P*{time})^{\alpha*1} \times (1 + w_2 \cdot P*{like})^{\alpha_2} \times \dots $$
- **特点**：
  - **核心指标**：通常以**观看时长 ($P_{time}$)** 为核心。
  - **调节机制**：引入了指数 $\alpha$。指数的作用是**放大或缩小分布的差异**。如果想极度强调时长，就把 $\alpha_1$ 调大。
  - **连乘**：意味着任何一个指标太差（接近 0），都会显著拉低总分，要求内容必须“六边形战士”或者某一项极强。

#### 案例二：国内“老铁”短视频 APP (基于排名的融合)

- **核心逻辑**：**Inverse Rank Fusion (逆排名融合)**。
- **公式**：
  $$ Score = \sum \frac{w_i}{(Rank_i)^{\alpha} + \beta} $$
- **步骤**：
  1.  先不融合，而是按点击率给所有候选排个序，拿到 $Rank_{click}$。
  2.  再按时长给所有候选排个序，拿到 $Rank_{time}$。
  3.  把这些**排名**代入公式计算总分。
- **深度洞察**：
  - **抗干扰**：模型输出的概率值（绝对值）经常会有波动（Drifting），比如今天模型抽风，输出的概率普遍偏低，如果用数值融合就会出问题。
  - **鲁棒性**：**排名是相对的**。不管模型输出的分数是 0.9 还是 0.09，只要它是第一名，排名就是 1。这种方法规避了**分数校准（Calibration）**的难题。

#### 案例三：国内某电商 APP (营收导向)

- **核心逻辑**：**Expected GMV (期望交易总额)**。
- **公式**：
  $$ Score = P*{click}^{\alpha} \times P*{cart}^{\beta} \times P\_{pay}^{\gamma} \times Price^{\delta} $$
- **物理意义**：
  - 如果所有指数都设为 1，这个公式就是：$P(曝光\to点击) \times P(点击\to加购) \times P(加购\to购买) \times 价格$。
  - 结果等于 **“单次曝光的期望收益” (eCPM / Expected Revenue)**。
- **目标**：电商极其现实，不看热闹（点击），只看赚钱（GMV）。将价格（Price）直接引入排序公式，是为了最大化平台的交易额。

---

### 3. 总结与权衡

| 策略         | 适用场景                | 核心优势                   | 劣势/难点                                            |
| :----------- | :---------------------- | :------------------------- | :--------------------------------------------------- |
| **加权求和** | 早期业务，指标少        | 简单，易解释               | 量纲不统一，难调参                                   |
| **概率连乘** | 内容资讯流              | 符合漏斗逻辑               | 需准确预估条件概率                                   |
| **幂律连乘** | 海外短视频              | 对长尾分布处理好，调节灵活 | 超参数极多，很难调                                   |
| **排名融合** | 国内短视频(Kuaishou 等) | **鲁棒性极强**，无需校准   | 计算量大(需先排 N 次序)，丢掉了绝对值包含的信息      |
| **GMV 乘积** | 电商/广告               | 直接优化营收               | 可能导致低价高转化商品或高价低转化商品被误判(需调参) |

**一针见血的结论**：
并没有“最好”的公式，**融分公式本质上是“业务指挥棒”的数学表达**。

- 老板想要留存，$\alpha_{time}$ 就调大；
- 老板想要互动，$\alpha_{like}$ 就调大；
- 老板想要营收，$\alpha_{price}$ 就调大。
  这也是为什么所有公式里都留了一堆 $w, \alpha, \beta$ —— 这些参数最终都要通过 **A/B 测试** 来确定，谁能带来大盘涨，谁就是对的。

---

- 怎么样建模都可以，但你会被 ab 测试毒打
