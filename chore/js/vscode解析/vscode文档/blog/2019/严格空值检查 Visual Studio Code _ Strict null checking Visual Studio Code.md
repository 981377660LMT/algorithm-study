---
title: 严格空值检查 Visual Studio Code
date: 2019/05/23
url: https://code.visualstudio.com/blogs/2019/05/23/strict-null
---

## 摘要

开启 TypeScript 的严格空值检查（`strictNullChecks`）通常意味着需要停产数周来修复数千个错误。然而对于 VS Code 这样规模的项目（当时 1800 个文件，50 万行代码，4500 个错误），Matt Bierner 分享了一种不中断业务的渐进式修复方案：通过创建一个额外的 `tsconfig.strictNullChecks.json` 文件，并从叶子节点（无外部依赖的文件）开始，逐个将修复好的文件加入这个白名单，最终在数月内实现了全代码库的严格空项覆盖。

## 一针见血的分析

这篇文章不仅是 TypeScript 的技术指南，更是一篇关于 **“软件工程风险治理”** 的经典案例。VS Code 团队提出了一个深刻的洞见：**“安全才能提速（Safety permits speed）”**。他们将错误视为系统性的“危险源（Hazards）”而非孤立事件。其工程设计的核心精髓在于**“文件级粒度的强约束演进”**：利用 TS 的扩展（Extends）机制建立影子配置，并通过 CI 强制保持已修复单元的“非退化”。这种方案避开了传统长分支合并（Merge Hell）的陷阱，证明了在不停机、不降低迭代频率的前提下，通过自动化脚本辅助（检测可增加文件）和持续集成，依然可以完成大规模、深层次的代码库架构重构。

1.  **安全助力速度 (Safety Permits Speed)**：
    - 团队意识到 `undefined` 导致的运行时崩溃是系统性风险。通过开启严格检查，可以将“运行时错误”转化为“编译时约束”，从而让开发者在重构和添加功能时更有信心追求速度。
2.  **渐进式迁移策略**：
    - **独立配置文件**：创建 `tsconfig.strictNullChecks.json`，初始包含 0 个文件。
    - **增量添加**：通过自动化脚本，只将那些“依赖项均已完成严格检查”的文件加入新配置。
    - **CI 保护**：在 CI 中运行针对新配置的编译检查，防止代码退化。
3.  **治理经验总结**：
    - **不要过度关注错误总数**：开启严格检查初期，错误数从 4500 开始不减反增（因为级联效应），团队转而关注“已达标文件数”。
    - **人工校验优于自动修复**：与其强行用 `!`（非空断言）消除报警，不如借此机会审视代码逻辑，判断是否真的需要可空值，从而提升代码质量。

---
