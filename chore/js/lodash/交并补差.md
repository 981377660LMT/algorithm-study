好的，我们来详细讲解 Lodash 中关于数组的四大集合操作：交集、并集、差集和补集（对称差）。

这些操作是处理数组时非常常用的功能，Lodash 为每种操作都提供了一套强大的函数。

### 1. 交集 (Intersection) - `_.intersection`

**含义**：获取所有给定数组中都存在的共有元素。

- **`_.intersection(array, ...arrays)`**:

  - **比较方式**：使用 `===` (严格相等) 进行比较。
  - **适用场景**：处理数字、字符串等原始类型。
  - **示例**：

    ```javascript
    const arr1 = [1, 2, 3]
    const arr2 = [2, 3, 4]
    const arr3 = [2, 5]

    const result = _.intersection(arr1, arr2, arr3)
    console.log(result)
    // => [2]  (因为只有 2 在所有三个数组中都存在)
    ```

- **`_.intersectionBy(array, ...arrays, iteratee)`**:

  - **比较方式**：先对每个元素应用 `iteratee` 函数或属性，然后比较返回的结果。
  - **适用场景**：根据对象的某个属性来求交集。
  - **示例**：

    ```javascript
    const arr1 = [
      { id: 1, name: 'A' },
      { id: 2, name: 'B' }
    ]
    const arr2 = [
      { id: 2, name: 'B-mod' },
      { id: 3, name: 'C' }
    ]

    // 根据 'id' 属性求交集
    const result = _.intersectionBy(arr1, arr2, 'id')
    console.log(result)
    // => [{ 'id': 2, 'name': 'B' }] (返回第一个数组中的元素)
    ```

- **`_.intersectionWith(array, ...arrays, comparator)`**:

  - **比较方式**：使用自定义的 `comparator` 函数来判断元素是否相等。
  - **适用场景**：需要复杂的自定义比较逻辑。
  - **示例**：

    ```javascript
    const arr1 = [
      { id: 1, val: 10 },
      { id: 2, val: 20 }
    ]
    const arr2 = [
      { id: 1, val: 30 },
      { id: 3, val: 40 }
    ]

    // 只要 id 相同就认为是同一个元素
    const result = _.intersectionWith(arr1, arr2, (a, b) => a.id === b.id)
    console.log(result)
    // => [{ id: 1, val: 10 }]
    ```

---

### 2. 并集 (Union) - `_.union`

**含义**：创建一个包含所有给定数组中唯一元素的新数组。结果中元素的顺序是它们在原数组中首次出现的顺序。

- **`_.union(...arrays)`**:

  - **比较方式**：`===` (严格相等)。
  - **适用场景**：合并多个原始类型数组并去重。
  - **示例**：

    ```javascript
    const arr1 = [1, 2, 3]
    const arr2 = [2, 4, 5]

    const result = _.union(arr1, arr2)
    console.log(result)
    // => [1, 2, 3, 4, 5]
    ```

- **`_.unionBy(...arrays, iteratee)`**:

  - **比较方式**：通过 `iteratee` 的结果来判断唯一性。
  - **适用场景**：合并对象数组并根据某个属性去重。
  - **示例**：

    ```javascript
    const arr1 = [{ id: 1, name: 'A' }]
    const arr2 = [
      { id: 2, name: 'B' },
      { id: 1, name: 'A-mod' }
    ]

    // 根据 'id' 属性合并并去重
    const result = _.unionBy(arr1, arr2, 'id')
    console.log(result)
    // => [{ 'id': 1, 'name': 'A' }, { 'id': 2, 'name': 'B' }]
    ```

- **`_.unionWith(...arrays, comparator)`**:

  - **比较方式**：使用自定义的 `comparator` 函数来判断唯一性。
  - **适用场景**：需要复杂逻辑来判断对象是否“重复”。
  - **示例**：

    ```javascript
    const arr1 = [{ id: 1, val: 10 }]
    const arr2 = [
      { id: 1, val: 20 },
      { id: 2, val: 30 }
    ]

    // 只要 id 相同就认为是重复元素
    const result = _.unionWith(arr1, arr2, (a, b) => a.id === b.id)
    console.log(result)
    // => [{ id: 1, val: 10 }, { id: 2, val: 30 }]
    ```

---

### 3. 差集 (Difference) - `_.difference`

**含义**：创建一个新数组，包含第一个数组中所有不在后续任何数组中的元素。

- **`_.difference(array, ...values)`**:

  - **比较方式**：`===` (严格相等)。
  - **示例**：

    ```javascript
    const arr1 = [1, 2, 3, 4]
    const arr2 = [3, 4, 5]

    // 找出在 arr1 中但不在 arr2 中的元素
    const result = _.difference(arr1, arr2)
    console.log(result)
    // => [1, 2]
    ```

- **`_.differenceBy(array, ...values, iteratee)`**:

  - **比较方式**：比较 `iteratee` 的结果。
  - **示例**：

    ```javascript
    const arr1 = [{ id: 1 }, { id: 2 }]
    const arr2 = [{ id: 2 }, { id: 3 }]

    // 根据 'id' 属性求差集
    const result = _.differenceBy(arr1, arr2, 'id')
    console.log(result)
    // => [{ 'id': 1 }]
    ```

- **`_.differenceWith(array, ...values, comparator)`**:

  - **比较方式**：使用自定义的 `comparator` 函数。
  - **示例**：

    ```javascript
    const arr1 = [
      { id: 1, val: 10 },
      { id: 2, val: 20 }
    ]
    const arr2 = [{ id: 2, val: 30 }]

    // 只要 id 相同就认为是相同元素
    const result = _.differenceWith(arr1, arr2, (a, b) => a.id === b.id)
    console.log(result)
    // => [{ id: 1, val: 10 }]
    ```

---

### 4. 补集 / 对称差 (Symmetric Difference) - `_.xor`

**含义**：在集合论中，“补集”需要一个“全集”的概念，这在数组操作中不常见。Lodash 提供了 `_.xor` 函数，它计算的是**对称差**，即存在于各个数组中，但不同时存在于所有数组中的元素的集合。可以理解为“只出现一次的元素集合”。

- **`_.xor(...arrays)`**:

  - **比较方式**：`===` (严格相等)。
  - **示例**：

    ```javascript
    const arr1 = [1, 2, 3]
    const arr2 = [3, 4, 5]

    // 找出在 arr1 或 arr2 中，但不同时在两者中的元素
    const result = _.xor(arr1, arr2)
    console.log(result)
    // => [1, 2, 4, 5]
    ```

- **`_.xorBy(...arrays, iteratee)`**:

  - **比较方式**：比较 `iteratee` 的结果。
  - **示例**：

    ```javascript
    const arr1 = [{ id: 1 }, { id: 2 }]
    const arr2 = [{ id: 2 }, { id: 3 }]

    // 根据 'id' 属性求对称差
    const result = _.xorBy(arr1, arr2, 'id')
    console.log(result)
    // => [{ 'id': 1 }, { 'id': 3 }]
    ```

- **`_.xorWith(...arrays, comparator)`**:

  - **比较方式**：使用自定义的 `comparator` 函数。
  - **示例**：

    ```javascript
    const arr1 = [
      { id: 1, val: 10 },
      { id: 2, val: 20 }
    ]
    const arr2 = [
      { id: 2, val: 30 },
      { id: 3, val: 40 }
    ]

    const result = _.xorWith(arr1, arr2, (a, b) => a.id === b.id)
    console.log(result)
    // => [{ id: 1, val: 10 }, { id: 3, val: 40 }]
    ```

### 总结

| 操作       | 基础版 (原始类型) | 属性版 (对象)      | 自定义版 (复杂逻辑)  |
| :--------- | :---------------- | :----------------- | :------------------- |
| **交集**   | `_.intersection`  | `_.intersectionBy` | `_.intersectionWith` |
| **并集**   | `_.union`         | `_.unionBy`        | `_.unionWith`        |
| **差集**   | `_.difference`    | `_.differenceBy`   | `_.differenceWith`   |
| **对称差** | `_.xor`           | `_.xorBy`          | `_.xorWith`          |

选择哪个函数取决于你的数据类型和比较需求的复杂度。这个 `By`/`With` 的命名模式在 Lodash 中非常通用，掌握它有助于你理解其他 Lodash 函数。
