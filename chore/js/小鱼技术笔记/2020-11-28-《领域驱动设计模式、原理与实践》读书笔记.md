2020-11-28-《领域驱动设计模式、原理与实践》读书笔记 DDD

## 概述

在阅读前我一直有几个大的困惑没有解决：

- `如何划分系统模块，让模块之间轻松加代码满足不断变化的需求`。正常情况下，我们是设计好了以后，后期加需求就会遇到困难，一个需求需要改好几个地方的代码。要小心翼翼，如履薄冰。并且这样的代码，`新来的人看起来会很头痛`，因为理解这个模块的代码需要牵涉多个模块和需求。
- 如何让模块像乐高一样堆起来，可以`动态地组合`。例如一个库存模块，可以支持多种不同类型的销售单据。或者一个销售单据，如何支持多个不同的库存模块。
- 如何做`单元测试`，单元测试现在的做法是对外部依赖加 mock，然后进行测试。但是 mock 的数量越多，测试就越脆弱，稍微的代码改动都会造成好几个单元测试重新改。更理想的情况是，mock 的数量小，同时单元测试的覆盖率也高。
- 如何做`多表的查询`。对于涉及多个模块的数据的筛选和查询功能，我的方法是在每个模块筛选后，组合结果，然后通过 getBatch 来组合数据，但是这样的性能很差。但是，当这些逻辑放在数据库来做的话，感觉各个模块的数据就会泄漏到数据库上。每个模块的功能就不再是内聚的，它可能会涉及多模块的数据。
- `面向对象编程模式的意义在哪里`。编程的时候，我既需要考虑数据库的表结构应该如何涉及，也要考虑业务模块- 如何划分，写逻辑的时候全部都是过程式代码。找不到 OOP 编程的意义在哪里，感觉 OOP 是多此一举。
- `事务问题`一直依赖于数据库的串行化隔离级别，因为一个命令，可能涉及多次的表操作，我们要保证写入的原子性。另一方面，要考虑并发情况下产生的数据竞争的问题。串行化的并发性能很低，但能保证结果一旦可靠和准确。如何在更好的并发性能下，实现原子性和隔离性。显然，在分布式环境下，我们更没有串行化隔离的级别，那么我们如何实现原子性和隔离性。

从建模，开发，测试，数据事务，这些问题一直困惑着我，使我没有往分布式的方向往前走。直到看到了这本书，这上面的大部分问题都得到了答案。而且令人惊讶的是，答案不是通过技术来实现的，而是**跳出了技术的思维，用业务的角度去考虑问题。**

## 启发

如果你手里拿的是锤子，那你看到的都是钉子。
`如果你是一个擅长技术的人，你就会将所有的问题都尝试用技术的方法来解决它，也没有考虑其他方法。而现实世界不是这样的，每个问题的背后，其实你可以用不同的角度和方法来解决它`。我们要做的是，综合多个方法的成本和结果，去选择最好的方法。而不是永远都在一个角度，一个方法上思考问题，这是非常悲哀的。
与此同时，DDD 教会了一个重要方法论，`永远要抓住核心是什么`。只有抓住核心矛盾才能解决问题，而不是要去尝试解决所有矛盾。
`一个项目的成功与否不是与项目最薄弱的地方决定的，而是由项目最核心价值是否实现来决定的`

## 核心理论
