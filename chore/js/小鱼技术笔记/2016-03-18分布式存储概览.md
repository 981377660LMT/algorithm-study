分布式存储概览
https://blog.fishedee.com/2016/03/18/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E6%A6%82%E8%A7%88/

## ACID

1. 简陋数据库
   数据库在执行完 update 操作后，竟然没有调用 file 的 sync，让数据强制写落到磁盘上，而是只缓存到内存中，`导致数据库掉电后重启造成事务丢失`。
   所以，数据库的第一个要求特性是持久性（Durability)，让每个事务执行后都必须落地磁盘，保证即使机器掉电后数据也不会丢失
2. D 数据库

转账断电，发现 10002 用户多了 100 元，而 10002 用户仍然是保持原值，没有增加 100 元!
有一个中间态!
所以，数据库的第二个要求特性是原子性（Atomicity），事务要么是全部提交的，要么是全部不提交的，这部分数据库是用 undo 日志来实现的。

3. AD 数据库

用户在家看到自己的钱突然多了 100 元，而后又少了 100 元。他空欢喜了一场，然后投诉我们公司，为什么给了自己 100 元，然后又突然抽走，他甚至还截图了自己多了 100 元数据的页面
为了避免这种恶心的情况，数据库的第三个要求特性是一致性(Consistency)，数据库只能看到提交后事务的数据，`不能看到事务操作过程中处于不一致状态`的数据。这部分数据库使用 MVCC 机制来实现的。

4. ACD 数据库

用户 10001 需要向 10002 与 10003 用户各转 100 元的，当然 10001 用户只有 120 元的情况下，他会成功么。答案是，他有可能会成功
所以，数据库的第四个要求特性是隔离性（Isolation），事务间应该有隔离，如果他们有数据冲突，应该进行上锁操作的

5. ACID 数据库

我们用了转钱的例子，来证明了 ACID 的每个特性都是多么必要的，不然会导致后果很严重的金钱问题。数据不一致，钱转多了，或者转少了。最后，总结一下 ACID 特性

原子性（Atomicity），强调写一致，要么全部完成，要么全部不完成。
一致性（Consistency），强调读一致，只能看到已经提交的事务数据。
隔离性（Isolation），强调并发一致，即使事务是并发执行的，数据也不会造成不一致。
持久性（Durability)，强调可靠，只要事务提交了，就不会丢失数据。

## CAP (C 和 A 无法同时在分布式系统中同时满足:网络延迟)

CP 和 AP 其实针对就是分布式系统当中的数据状态，在实际业务中还是需要根据实际情况来进行取舍和平衡

在一个 CAP 分布式系统中， Consistency（一致性）、 Availability（可用性）、Partition tolerance（分区容错性），三者不可得兼。

- 一致性（Consistency）：
  在分布式系统中的所有`数据备份，在同一时刻是否同样的值`。（等同于所有节点访问同一份最新的数据副本）
- 可用性（Availability）：
  在集群中一部分节点`故障`后，集群整体是否还能响应客户端的读写请求。（对数据更新具备高可用性）
- 分区容忍性（Partition tolerance）：
  以实际效果而言，分区相当于`对通信的时限要求`。
  系统如果不能在时限内达成数据一致性，就意味着发生了分区的情况，必须就当前操作在 C 和 A 之间做出选择。

CAP 原理就像是能量守恒定律一样，给那些想实现永动机，和想实现`分布式 ACID` 的人们当头一棒，这是不可能的

- 各种中间件使用什么理论
  https://juejin.cn/post/7021717177220726798

  - 单机 mysql:CA
  - zookeeper:CP
  - eureka:AP
  - mysql 主从: 与 redis 类似，一主多从，不保证数据数据节点同步的实时性，保证数据吞吐量使用 AP，保证主从同步一致则使用 CP.
  - nacos: 会根据不同的实例类型选择不同的架构
    临时实例，选择 AP 架构，使用 Distro 协议，分布式协议的一种，阿里内部的协议，服务是放在内存中
    持久实例，选择 CP 架构，使用 Raft 协议来实现，点击查看 Raft 协议详情！服务是放在磁盘中

## BASE 原则

BASE 是在无法满足 CAP 原则的情况下评估出的一种原则，代表是基本可用（`B`asically `A`vailable）、软状态（`S`oft state）和最终一致性（`E`ventually consistent）
**BASE 是对 CAP 中一致性和可用性权衡的结果**

- 基本可用指的是分布式系统在遇到故障的情况下降低一定的可用性，例如请求返回要慢点，活动期间出现等待页面。
- 软状态是在和服务器的交互过程中出现下游系统拥堵的情况下，给数据加上一个中间状态，例如商城购买商品时候的支付中，支付完成。允许系统在多个不同节点的数据副本存在数据延时。
- 最终一致性是数据最终要达到一致的情况。比如一笔支付中状态的数据，它最终要么是支付完成，要么是支付失败。支付中的状态存留的时间取决下游支付系统完成这笔支付的时间。

BASE 理论面向的是大型高可用可扩展的分布式系统，和传统的事物 ACID 特性是相反的，它完全不同于 ACID 的强一致性模型，而是通过`牺牲强一致性来获得可用性，并允许数据在一段时间内是不一致的，但最终达到一致状态`
