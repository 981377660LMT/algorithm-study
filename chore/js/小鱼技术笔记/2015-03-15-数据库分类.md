2015-03-15-数据库分类

1. 关系型数据库（OLTP）
   阿里云上的 RDS 都属于关系型的数据库，包含有 mysql，sql server 等等
   - 优点：
     满足 ACID 原则，强事务性
   - 缺点
     要完全满足 ACID，则只能单机中实现，这会导致数据量增长有限，当数据量在千万级时就已经很吃力了
   - 适用场景：
     要求`可靠`，银行系统，一分钱都不能坏。
     要求`一致性`，踩楼活动的楼层数，快速写同时楼层数要按序增加，不重复
2. 缓存数据库(Cache)
   阿里云上的 memcache 和 redis 都属于缓存数据库
   - 优点：
     由于数据完全在内存上，所以速度非常快
   - 缺点：
     数据不可靠，掉电后可能会丢失一小部分数据
     数据没有一致性，不要考虑事务性了
   - 适用场景：
     要求`快`，但不要求数据能放很多的场景。关系型数据库的`热数据存储区`，将大部分的热数据放在 cache 上，只能很少使用的冷数据库才放在数据库上。这样能满足绝大部分用户的快速读的请求。
     要求`快，但不要求数据可靠`的场景。session。
3. 分布式非结构化存储数据库(NoSql)
   非结构化数据，像音乐，图片，视频，这类缺少结构化的数据。阿里云提供的是 OSS 存储服务，也有做得好的七牛，又拍云这类服务商。开源的有 hdfs。

   - 优点：
     读写`量大`，数据量大
   - 缺点：
     无事务性，只能存非结构化数据。
   - 适用场景：
     音乐，图片，视频，`静态文件等非结构化数据`

4. 分布式结构化存储数据库
   分布式结构化存储数据库，要求能存放 TB 级的结构化数据，而且支持快速的增删改查的操作，对事务性的要求不高，而且增删改查操作都是在毫秒级类完成的。
   阿里云上分别有 DRDS，mongodb 和 TableStore。开源的有 hbase。

   - DRDS
     将单机数据库扩展多机数据库，通过数据的 sharding 来将数据切分到多个表上。例如用户表，就是以用户 ID 为 key，哈希到多台 mysql 数据库上。DRDS 的优点是能存储数据量大，并保持了单表中的事务性，跨表操作中只支持最终的一致性。缺点是 schema 比较死。
     适合在需要最终一致性的大数据场景，读写量少，例如电商订单信息。

   - Mongodb
     仍然是数据 sharding 分布在多个表上，优点是，数据量大，schema 灵活，可以动态变化，而且数据类型支持嵌套对象或数组，读取写入速度非常快。缺点是一致性差，经常看到有用户抱怨丢数据。
     适合在 schema 灵活的大数据场景，读写量多，例如用户个人信息。

5. 分布式计算数据库（OLAP）
   分布式计算数据库，要求能存放 TB/PB 级的结构化数据，数据只能增加，不能删除或修改，对全量数据分析比 DRDS，mongodb 等相比非常快，不过仍然也要在秒级类完成的。阿里云上的 ODPS。
   开源的有 hadoop,hive,storm,spark 等等。
   注意，分析 OLAP 引擎，需要从`数据量，灵活性和性能`三方面考虑，没有一个架构能同时在数据量，灵活性和性能这三个方面做到完美。

   - MPP 架构
     MPP 架构数据量最大，灵活性最好，性能一般（分钟级）。它的想法是 share nothing，将数据库切片存储，查询时将各个机器上计算，然后在主机器上聚合数据。

     - Map-Reduce
       将分布式计算抽象为 map-reduce 两个操作，然后让开发者编写这两步的接口即可实现分布式计算。优点是适用范围广，缺点每次都要重复发明 count(_)，max(_)等的操作。`开源的实现有 hadoop`，阿里云上的实现为 E-MapReduce
     - sql 的分布式计算
       将原来熟知的 sql 计算解析为一系列的 map-reduce 操作，然后让 map-reduce 操作来执行，从而实现了输入原来简单的 sql 运算就能达到分布式计算的目的。`开源的实现有 hive`，阿里云上的实现为 odps。
     - 分布式流计算
       基于 map-reduce 的分布式计算都是`批处理任务`，实时性比较差。然后发明了让数据流过分布式机器，而不是机器读取分布式数据的方法，实现了分布式的增量计算。`开源的实现有 storm`，阿里云上的实现为 odps。
     - **统一分布式计算**
       由于 hadoop 的难用，hive 的低效，storm 的增量计算适用范围有限，导致了一个新的分布式计算框架出现，spark。spark 有以下的几点优化：

       1. 使用`内存做中间结果缓存`。借鉴了 storm 的优点，避免了 hadoop 不断读写磁盘造成严重的性能问题。
       2. `RDD 优化并行`作业流水线。各个分布式任务之间的`依赖在执行前就可以确定`下来，使得 spark 知道如何加快流水线的速度，避免 hadoop 在 reduce 时需要盲目等待前面所有 map 的完成。
       3. 将数据切片分成单个 batch。借鉴了 storm 的流计算优点，避免了 hadoop 只能做批处理的问题。

       `spark 借鉴了多个分布式计算框架的优点`，从而实现了一个统一的同时支持`实时计算，离线计算`，图计算和机器学习计算的框架。阿里云上对应的实现为 E-MapReduce。

   - 搜索引擎架构
     搜索引擎架构架构数据量中，灵活性中，性能好(亚秒级)。它的想法是建立倒排索引，能够实现多字段查询后将各个记录的数据进行交集和并集，过滤，最后排序输出。所以，这个架构最先在搜索引擎实现，首先对输入句子划分多个 term，然后用每个 term 得到记录求交集，过滤不符合的数据，最后排序输出。
     elasticsearch
     Elasticsearch 是基于 Lucene 的搜索服务器，它提供了一个分布式多用户能力的全文搜索引擎，基于 RESTful web 接口。
   - MOLAP 架构
     MOLAP 架构数据量最小，灵活性差，性能好（亚秒级）。`它的想法是建立 cube`，在输入数据时根据预定义的查询计划，将数据提前做好 join 和 count 等连接和聚合操作，并保存起来。查询时直接从 cube 中提取数据，所以速度很快。
     Apache Kylin™ 是一个开源的分布式分析引擎，提供 Hadoop 之上的 SQL 查询接口及多维分析（OLAP）能力以支持超大规模数据，最初由 eBay Inc. 开发并贡献至开源社区。它能在亚秒内查询巨大的 Hive 表。

   场景
   适合做大数据分析。

   1. 日志服务，详细分析一个月内的某接口的调用情况。（搜索引擎架构）
   2. 网页分析服务，详细分析每天的页面访问量，跳出率等数据（Kylin 架构）。
   3. 数据挖掘，像聚类算法，pageRank 算法（MPP 架构）。
   4. PV,UV,排行榜等统计数据的实时维护（Kylin 架构）。
