https://github.com/981377660LMT/articles/blob/af32bed62ae47d7c245d2089ce60f09f715b6b66/0706/debug%E5%B0%8F%E5%86%8C.md?plain=1#L4

## vscode debugger ä¸¤ä¸ªä¼˜åŠ¿ï¼š

1. å›æº¯
2. è¾¹è°ƒè¯•è¾¹å†™ä»£ç æ˜¯æˆ‘æ¨èçš„å†™ä»£ç æ–¹å¼ã€‚

## vscode debugger é…ç½®ç¬”è®°

1. userDataDir

`user data dir æ˜¯ä¿å­˜ç”¨æˆ·æ•°æ®çš„åœ°æ–¹ï¼Œæ¯”å¦‚æµè§ˆå†å²ã€cookie ç­‰ï¼Œä¸€ä¸ªæ•°æ®ç›®å½•åªèƒ½è·‘ä¸€ä¸ª chromeï¼Œæ‰€ä»¥é»˜è®¤ä¼šåˆ›å»ºä¸´æ—¶ç”¨æˆ·æ•°æ®ç›®å½•ï¼Œæƒ³ç”¨é»˜è®¤çš„ç›®å½•å¯ä»¥æŠŠè¿™ä¸ªé…ç½®è®¾ä¸º false`
![ä»£ä»·æ˜¯ï¼Œåªèƒ½å¼€ä¸€ä¸ªæµè§ˆå™¨å®ä¾‹](image.png)
ç”¨æˆ·æ•°æ®ç›®å½•æœ‰ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯åªèƒ½è¢«ä¸€ä¸ª Chrome å®ä¾‹æ‰€è®¿é—®ï¼Œå¦‚æœä½ ä¹‹å‰å¯åŠ¨äº† Chrome ç”¨äº†è¿™ä¸ªé»˜è®¤çš„ user data dirï¼Œé‚£å°±ä¸èƒ½å†å¯åŠ¨ä¸€ä¸ª Chrome å®ä¾‹ç”¨å®ƒäº†ã€‚
é»˜è®¤æ˜¯ trueï¼Œä»£è¡¨åˆ›å»ºä¸€ä¸ªä¸´æ—¶ç›®å½•æ¥ä¿å­˜ç”¨æˆ·æ•°æ®ã€‚
ä½ ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„è·¯å¾„ï¼Œè¿™æ ·ç”¨æˆ·æ•°æ®å°±ä¼šä¿å­˜åœ¨é‚£ä¸ªç›®å½•ä¸‹ï¼š

2. sourceMapPathOverrides
   ![alt text](image-1.png)

   `ç¼–è¯‘åä»£ç è·¯å¾„ -- sourcemap -> æºç è·¯å¾„ -- sourceMapPathOverrides -> æœ¬åœ°æ–‡ä»¶è·¯å¾„`
   æŠŠè°ƒè¯•çš„æ–‡ä»¶ sourcemap åˆ°çš„è·¯å¾„æ˜ å°„åˆ°æœ¬åœ°çš„æ–‡ä»¶ï¼Œè¿™æ ·è°ƒè¯•çš„ä»£ç å°±ä¸å†åªè¯»äº†ï¼š

   ```json
   // é»˜è®¤æŠŠ meteorã€webpack å¼€å¤´çš„ path æ˜ å°„åˆ°äº†æœ¬åœ°çš„ç›®å½•ä¸‹
   // å…¶ä¸­ ?:* ä»£è¡¨åŒ¹é…ä»»æ„å­—ç¬¦ï¼Œä½†ä¸æ˜ å°„ï¼Œè€Œ * æ˜¯ç”¨äºåŒ¹é…å­—ç¬¦å¹¶æ˜ å°„çš„ã€‚
   "sourceMapPathOverrides": {
     "meteor://ğŸ’»app/*": "${workspaceFolder}/*",
     "webpack:///./~/*": "${workspaceFolder}/node_modules/*",
     "webpack://?:*/*": "${workspaceFolder}/*"
   }
   ```

3. console
   internalConsole å°±æ˜¯å†…ç½®çš„ debug console é¢æ¿ï¼Œé»˜è®¤æ˜¯è¿™ä¸ªã€‚
   **internalTerminal æ˜¯å†…ç½®çš„ terminal é¢æ¿ï¼Œåˆ‡æ¢æˆè¿™ä¸ªå°±æ˜¯å½©è‰²äº†** <- æ¨è
   externalTerminal ä¼šæ‰“å¼€ç³»ç»Ÿçš„ terminal æ¥å±•ç¤ºæ—¥å¿—ä¿¡æ¯ï¼š
4. env/envFile
   è¿™æ ·åœ¨è°ƒè¯•çš„ node ç¨‹åºé‡Œå°±å¯ä»¥å–åˆ°è¿™äº›ç¯å¢ƒå˜é‡
5. cwd
   æŒ‡å®šå·¥ä½œç›®å½•ï¼Œä½¿ç”¨åœºæ™¯ï¼šè¿è¡Œå¯¹åº”ç›®å½•ä¸‹çš„ package.json é‡Œçš„è„šæœ¬
6. resolveSourceMapLocations
   é»˜è®¤å€¼æ˜¯æ’é™¤æ‰äº† node_modules ç›®å½•çš„ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šæŸ¥æ‰¾ node_modules ä¸‹çš„ sourcemapã€‚

## sourcemap ç›¸å…³

å¼€å‘æ—¶ä¼šä½¿ç”¨ sourcemap æ¥è°ƒè¯•ï¼Œä½†æ˜¯ç”Ÿäº§å¯ä¸ä¼šï¼Œä½†æ˜¯çº¿ä¸ŠæŠ¥é”™çš„æ—¶å€™ç¡®å®ä¹Ÿéœ€è¦å®šä½åˆ°æºç ï¼Œè¿™ç§æƒ…å†µä¸€èˆ¬éƒ½æ˜¯å•ç‹¬ä¸Šä¼  sourcemap åˆ°é”™è¯¯æ”¶é›†å¹³å°ã€‚
æ¯”å¦‚ sentry å°±æä¾›äº†ä¸€ä¸ª Â @sentry/webpack-pluginÂ  æ”¯æŒåœ¨**æ‰“åŒ…å®ŒæˆåæŠŠ sourcemap è‡ªåŠ¨ä¸Šä¼ åˆ° sentry åå°ï¼Œç„¶åæŠŠæœ¬åœ° sourcemap åˆ æ‰ã€‚è¿˜æä¾›äº† Â @sentry/cliÂ  è®©ç”¨æˆ·å¯ä»¥æ‰‹åŠ¨ä¸Šä¼ ã€‚**

å¦‚ä½•ç”Ÿæˆ sourcemap?
`ç”¨ source-map åº“ç”Ÿæˆ sourcemapï¼Œ`

## è°ƒè¯• Vue é¡¹ç›®

1. è°ƒè¯• @vue/cli åˆ›å»ºçš„ webpack é¡¹ç›®
   vue cli åˆ›å»ºçš„é¡¹ç›®ï¼Œé»˜è®¤æƒ…å†µä¸‹æ‰“æ–­ç‚¹ä¸ç”Ÿæ•ˆï¼Œè¿™æ˜¯å› ä¸ºæ–‡ä»¶è·¯å¾„åå¸¦äº† `?hash`ï¼Œè¿™æ˜¯é»˜è®¤çš„ eval-cheap-module-source-map çš„ devtool é…ç½®å¯¼è‡´çš„ï¼Œå»æ‰ evalï¼Œæ”¹ä¸º source-map å³å¯ã€‚
2. è°ƒè¯• create vue åˆ›å»ºçš„ vite é¡¹ç›®
   `å¦‚æœ sourcemap åˆ°çš„æ–‡ä»¶è·¯å¾„ä¸æ˜¯æœ¬åœ°è·¯å¾„ï¼Œé‚£å°±æ˜ å°„ä¸åˆ°æœ¬åœ°æ–‡ä»¶ï¼Œå¯¼è‡´æ–­ç‚¹æ‰“ä¸ä¸Šï¼Œè¿™æ—¶å€™å¯ä»¥é…ç½®ä¸‹ sourceMapPathOverridesã€‚å¦‚æœæ˜ å°„ä¹‹åè·¯å¾„å¼€å¤´å¤šäº†å‡ å±‚ç›®å½•ï¼Œé‚£å°±è¦é…ç½®ä¸‹ webRootã€‚`
   å¦‚æœæƒ³ç‚¹å‡»è°ƒç”¨æ ˆç›´æ¥åœ¨ workspace æ‰“å¼€å¯¹åº”çš„æ–‡ä»¶ï¼Œè¿™éœ€è¦æŠŠ demo é¡¹ç›®å’Œ vue3 æºç é¡¹ç›®æ”¾åˆ°ä¸€ä¸ª workspace ä¸‹ï¼Œå†æ¬¡è°ƒè¯•å°±å¯ä»¥äº†ã€‚

## VSCode Chrome Debugger æ–­ç‚¹æ˜ å°„çš„åŸç†

VSCode Debugger é‡Œæ‰“çš„æ–­ç‚¹æ˜¯æ€ä¹ˆåœ¨ç½‘é¡µé‡Œç”Ÿæ•ˆçš„ï¼Ÿ

1. VSCode ä¼šè®°å½•ä½ åœ¨å“ªä¸ªæ–‡ä»¶å“ªè¡Œæ‰“äº†ä¸ªæ–­ç‚¹ï¼Œç„¶åä¼šæŠŠè¿™ä¸ªä¿¡æ¯å‘ç»™ Chromeã€‚
   è¿™æ˜¯ä¸€ä¸ªå½¢å¦‚ `/Users/guang/code/foo/src/App.vue` çš„`ç»å¯¹è·¯å¾„`
   ä½†æ˜¯é—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬æœ¬åœ°æ‰“çš„æ–­ç‚¹æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯åŒ…å« `${workspaceFolder}` çš„è·¯å¾„ï¼Œè€Œç½‘é¡µé‡Œæ ¹æœ¬æ²¡æœ‰è¿™ä¸ªè·¯å¾„ï¼Œé‚£æ€ä¹ˆæ–­ä½çš„å‘¢ï¼Ÿ
   è¿™æ˜¯å› ä¸ºæœ‰çš„æ–‡ä»¶æ˜¯å…³è”äº† sourcemap çš„ï¼Œå®ƒä¼šæŠŠæ–‡ä»¶è·¯å¾„æ˜ å°„åˆ°æºç è·¯å¾„
   å¦‚æœæ˜ å°„åˆ°çš„æºç è·¯å¾„ç›´æ¥å°±æ˜¯æœ¬åœ°çš„æ–‡ä»¶è·¯å¾„ï¼Œé‚£æ–­ç‚¹å°±ç”Ÿæ•ˆäº†ã€‚
   ![alt text](image-2.png)
   vite çš„é¡¹ç›®ï¼Œsourcemap éƒ½æ˜¯è¿™ç§ç»å¯¹è·¯å¾„ï¼Œæ‰€ä»¥æ–­ç‚¹ç›´æ¥å°±ç”Ÿæ•ˆäº†ã€‚
   ä½†æ˜¯ webpack çš„é¡¹ç›®ï¼Œsourcemap åˆ°çš„è·¯å¾„ä¸æ˜¯ç»å¯¹è·¯å¾„ï¼Œè€Œæ˜¯è¿™ç§ï¼š
   ![alt text](image-3.png)
   æœ¬åœ°æ‰“çš„æ–­ç‚¹éƒ½æ˜¯ç»å¯¹è·¯å¾„ï¼Œè€Œ sourcemap åˆ°çš„è·¯å¾„ä¸æ˜¯ç»å¯¹è·¯å¾„ï¼Œæ ¹æœ¬æ‰“ä¸ä¸Šå‘€ï¼
   `æ‰€ä»¥ VSCode Chrome Debugger æ”¯æŒäº† sourceMapPathOverrides çš„é…ç½®ï¼Œè®©æ‰“æ–­ç‚¹çš„æ–‡ä»¶è·¯å¾„å’Œ sourcemap ä¹‹åçš„æ–‡ä»¶è·¯å¾„å¯¹ä¸Š`
   å¦‚æœæ˜ å°„ä¹‹åè·¯å¾„å¼€å¤´å¤šäº†å‡ å±‚ç›®å½•ï¼Œé‚£å°±è¦é…ç½®ä¸‹ webRootã€‚

## ç”¨ VSCode è°ƒè¯• React é¡¹ç›®

1. éœ€è¦ build å‡ºå¸¦æœ‰ sourcemap çš„ react åŒ…
2. ä¸‹è½½ä¹‹å reset åˆ°è¿™ä¸ª commitï¼š

   ```bash
   git reset --hard 80f3d88190c07c2da11b5cac58a44c3b90fbc296
   ```

3. æ‰¾åˆ° rollup çš„é…ç½®ï¼Œæ·»åŠ ä¸€è¡Œ sourcemap: trueï¼Œè®© rollup åœ¨æ„å»ºæ—¶äº§ç”Ÿ sourcemapï¼š
4. æ‰¾å‡ºæ²¡æœ‰ç”Ÿæˆ sourcemap çš„é‚£å‡ ä¸ªæ’ä»¶æ³¨é‡Šæ‰

## æ–‡ä»¶åªè¯»ï¼Œå¯èƒ½æ˜¯æœ¬åœ°ä¸å­˜åœ¨è¿™ä¸ªæ–‡ä»¶

æŠŠè°ƒè¯•çš„æ–‡ä»¶ sourcemap åˆ°çš„è·¯å¾„`æ˜ å°„`åˆ°æœ¬åœ°çš„æ–‡ä»¶ï¼Œè¿™æ ·è°ƒè¯•çš„ä»£ç å°±ä¸å†åªè¯»äº†ï¼š

## json ä¸ jsonc

scope æŒ‡å®šä¸º json å’Œ jsoncï¼Œè¿™æ˜¯å› ä¸º json æ–‡ä»¶å¯¹åº”ä¸¤ç§è¯­è¨€ï¼š

jsonc æ˜¯ json with commentsï¼Œå¸¦æ³¨é‡Šçš„ jsonï¼Œå› ä¸º json è¯­æ³•æ˜¯ä¸æ”¯æŒæ³¨é‡Šçš„ï¼Œè€Œæˆ‘ä»¬åˆæƒ³åœ¨ json æ–‡ä»¶é‡ŒåŠ ä¸€äº›æ³¨é‡Šï¼Œæ‰€ä»¥å¹³æ—¶éƒ½æ˜¯ç”¨ jsonc çš„ç±»å‹ã€‚

## è°ƒè¯• npm scripts

æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ npx æ¥è·‘ï¼Œæ¯”å¦‚ npx xxï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯æ‰§è¡Œ node_modules/.bin ä¸‹çš„æœ¬åœ°å‘½ä»¤ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ä¼šä» npm ä¸‹è½½ç„¶åæ‰§è¡Œã€‚
npm scripts æœ¬è´¨ä¸Šè¿˜æ˜¯ç”¨ node æ¥è·‘è¿™äº› script ä»£ç ï¼Œæ‰€ä»¥è°ƒè¯•ä»–ä»¬å’Œè°ƒè¯•å…¶ä»– node ä»£ç æ²¡å•¥åŒºåˆ«ã€‚

1. ä¹Ÿå°±æ˜¯å¯ä»¥è¿™æ ·è·‘ï¼š
   åœ¨ .vscode/launch.json çš„è°ƒè¯•æ–‡ä»¶é‡Œï¼Œé€‰æ‹© node çš„ launch programï¼š
   ç”¨ node æ‰§è¡Œ node_modules/.bin ä¸‹çš„æ–‡ä»¶ï¼Œä¼ å…¥å‚æ•°å³å¯ï¼š

```json
"configurations": [
  {
    "type": "node",
    "request": "launch",
    "name": "Launch Program",
    "skipFiles": ["<node_internals>/**"],
    "program": "${workspaceFolder}/node_modules/.bin/xx.js",
    "args": ["--arg1", "value1"]
  }
]
```

![alt text](image-4.png)

2. å…¶å®è¿˜æœ‰æ›´ç®€å•çš„æ–¹å¼ï¼ŒVSCode Debugger å¯¹ npm scripts è°ƒè¯•çš„åœºæ™¯åšäº†å°è£…ï¼Œå¯ä»¥ç›´æ¥é€‰æ‹© npm ç±»å‹çš„è°ƒè¯•é…ç½®ï¼š

```json
"configurations": [
  {
    "type": "pwa-node",
    "request": "launch",
    "runtimeExecutable": "npm",
    "runtimeArgs": ["run-script", "foo"],
  }
]
```

## å‘½ä»¤è¡Œå·¥å…·çš„ä¸¤ç§è°ƒè¯•æ–¹å¼ï¼ˆä»¥ ESLint æºç è°ƒè¯•ä¸ºä¾‹ï¼‰

è¿™äº›å‘½ä»¤è¡Œå·¥å…·éƒ½æä¾›äº†ä¸¤ç§å…¥å£ï¼š**å‘½ä»¤è¡Œå’Œ apiã€‚**

1. å‘½ä»¤è¡Œçš„æ–¹å¼è°ƒè¯• ESLint æºç 
   æ¢ç©¶ fix çš„åŸç†
   `npx eslint ./index.js --fix ` åšäº†ä»€ä¹ˆï¼Ÿ

   ```json
   {
     "type": "node",
     "name": "eslint è°ƒè¯•",
     "program": "${workspaceFolder}/node_modules/.bin/eslint",
     "args": ["./index.js", "--fix"],
     "skipFiles": ["<node_internals>/**"],
     "console": "integratedTerminal",
     "cwd": "${workspaceFolder}",
     "request": "launch"
   }
   ```

   åœ¨ .bin ä¸‹æ‰¾åˆ° eslint çš„æ–‡ä»¶æ‰“ä¸ªæ–­ç‚¹

   eslint çš„å®ç°åŸç†ï¼š
   ![alt text](image-5.png)
   lint çš„å®ç°æ˜¯åŸºäº ASTï¼Œè°ƒç”¨ rule æ¥åšçš„æ£€æŸ¥ã€‚
   fix çš„å®ç°å°±æ˜¯å­—ç¬¦ä¸²çš„æ›¿æ¢ï¼Œå¤šä¸ª fix æœ‰å†²çªçš„è¯ä¼šå¾ªç¯å¤šæ¬¡ä¿®å¤ï¼Œé»˜è®¤ä¿®å¤ 10 æ¬¡è¿˜æ²¡ä¿®å¤å®Œå°±ç»ˆæ­¢ã€‚

2. api çš„æ–¹å¼è°ƒè¯• ESLint æºç 
   ESLint ä¼šåˆ›å»º ESLint å®ä¾‹ï¼Œç„¶åè°ƒç”¨ lintText æ–¹æ³•æ¥å¯¹ä»£ç  lintã€‚

   ESLint æºç çš„è°ƒè¯•è¿˜æ˜¯ç›¸å¯¹ç®€å•ï¼Œå› ä¸ºæ²¡æœ‰ç»è¿‡ç¼–è¯‘ï¼Œå¦‚æœåšäº†ç¼–è¯‘çš„è¯ï¼Œé‚£å°±éœ€è¦ sourcemap äº†

## æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ä¿®æ”¹ node_modules ä¸‹çš„ä¸€äº›ä»£ç ï¼Œä½†æ˜¯ node_modules ä¸ä¼šæäº¤åˆ° git ä»“åº“ï¼Œæ”¹åŠ¨ä¿å­˜ä¸ä¸‹æ¥ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ

https://github.com/ds300/patch-package#readme
**è¿™æ—¶å€™å¯ä»¥ç”¨ patch-package è¿™ä¸ªå·¥å…·ã€‚**
å½“æˆ‘ä»¬éœ€è¦å¯¹ node_modules ä¸‹çš„ä»£ç åšæ”¹åŠ¨çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ patch-package xxx ç”Ÿæˆ patches æ–‡ä»¶ï¼Œå®ƒå¯ä»¥è¢«æäº¤åˆ° git ä»“åº“ï¼Œç„¶åå†æ‹‰ä¸‹æ¥çš„ä»£ç å°±å¯ä»¥é€šè¿‡ patch-package æ¥åº”ç”¨æ”¹åŠ¨ã€‚

1. ä½¿ç”¨:

```bash
# å¯¹node_modules/some-package/brokenFile.jsåšæ”¹åŠ¨
vim node_modules/some-package/brokenFile.js

# ç”Ÿæˆpatchæ–‡ä»¶
npx patch-package some-package

# æäº¤patchæ–‡ä»¶
git add patches/some-package+3.14.15.patch
git commit -m "fix brokenFile.js in some-package"

# æŠŠé¡¹ç›®æ‹‰ä¸‹æ¥çš„æ—¶å€™ï¼Œæ‰§è¡Œä¸‹ npx patch-package å°±ä¼šåº”ç”¨è¿™æ¬¡æ”¹åŠ¨
# å¯ä»¥æŠŠå®ƒé…åˆ° postintsll é‡Œï¼Œæ¯æ¬¡å®‰è£…å®Œä¾èµ–è‡ªåŠ¨è·‘ã€‚
# è¿™æ ·èƒ½ä¿è¯æ¯æ¬¡æ‹‰å–ä¸‹æ¥çš„ä»£ç éƒ½åŒ…å«äº†å¯¹ node_modules çš„æ”¹åŠ¨ã€‚
```

2. è°ƒè¯• patch-package æºç 
   å®ƒé»˜è®¤å°±æ˜¯æœ‰ sourcemap çš„ï¼Œåªä¸è¿‡æ˜¯ base64 çš„æ–¹å¼å†…è”çš„(ts é…ç½® inlinsourcemap: true)
   ![alt text](image-6.png)

   æ¢ç©¶å®ƒçš„å®ç°åŸç†è¦åˆ†ä¸ºä¸¤å„æ–¹é¢ï¼š
   **ä¸€ä¸ªæ˜¯ patches æ–‡ä»¶æ€ä¹ˆç”Ÿæˆçš„ï¼Œä¸€ä¸ªæ˜¯ patches æ–‡ä»¶æ€ä¹ˆè¢«åº”ç”¨çš„ã€‚**

   1. patches æ–‡ä»¶æ€ä¹ˆç”Ÿæˆçš„(generate)
      çœ‹ patches æ–‡ä»¶çš„å†…å®¹å°±èƒ½çœ‹å‡ºæ¥è¿™æ˜¯ git çš„ diffï¼š
      patch-package å°±æ˜¯ä¾èµ– git diff å®ç°çš„ patches æ–‡ä»¶ç”Ÿæˆ
      ä½ å¯ä»¥å…ˆå¯¹ node_modules ä¸‹çš„æŸä¸ªåŒ…åšä¸‹æ”¹åŠ¨ï¼Œç„¶åæ‰§è¡Œ node ./dist/index xxx æ¥ç”Ÿæˆ patches æ–‡ä»¶

      `å¥½å·§å¦™çš„æ–¹æ³•ï¼`ï¼š
      **åœ¨ä¸´æ—¶ç›®å½•ç”Ÿæˆ package.jsonï¼Œä¸‹è½½ä¾èµ–ï¼Œç”Ÿæˆä¸€ä¸ª commitï¼Œç„¶åæŠŠæ”¹åŠ¨çš„ä»£ç å¤åˆ¶è¿‡å»ï¼Œä¸¤è€…åš gif diffï¼Œå°±å¯ä»¥ç”Ÿæˆ patches æ–‡ä»¶**

   2. patches å¦‚ä½•è¢«åº”ç”¨çš„(apply)
      patch-package è‡ªå·±å®ç°äº†å®ƒçš„ parseï¼Œè§£æ patch æ–‡ä»¶ï¼Œæ‹¿åˆ°å¯¹ä»€ä¹ˆæ–‡ä»¶çš„å“ªäº›è¡Œåšä»€ä¹ˆä¿®æ”¹çš„ä¿¡æ¯ï¼Œä¹‹åæ ¹æ®ä¸åŒåšç±»å‹åšä¸åŒçš„æ–‡ä»¶æ“ä½œå°±å¯ä»¥äº†
      å¦‚æœæ˜¯ pnpmï¼Œé‚£ patch-package ä¸æ”¯æŒï¼Œè¿™æ—¶å€™ç”¨å†…ç½®çš„ pnpm patch å‘½ä»¤å°±å¥½äº†ã€‚
      `pnpm å†…ç½® patchã€patch-commit å‘½ä»¤ï¼Œä½œç”¨å’Œè¿™ä¸ª patch-package åŒ…ä¸€æ ·`

## è°ƒè¯• Babel æºç 

Babel æ˜¯ä¸€ä¸ª JS çš„ç¼–è¯‘å™¨ï¼Œç”¨äºæŠŠé«˜ç‰ˆæœ¬è¯­æ³•çš„ä»£ç è½¬æˆä½ç‰ˆæœ¬çš„ï¼Œå¹¶ä¸”æ·»åŠ  polyfillã€‚
å®ƒæœ‰å¾ˆå¤šæ’ä»¶ï¼Œæ’ä»¶è¿˜è¿›ä¸€æ­¥å°è£…æˆäº†é¢„è®¾ï¼ˆpresetï¼‰ï¼Œå¼€ç®±å³ç”¨ã€‚
æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å†™ Babel æ’ä»¶æ¥å®Œæˆä¸€äº›ç‰¹å®šçš„ä»£ç è½¬æ¢ã€‚
`@babel/parserã€@babel/traverseã€@babel/generator `

```js
const parser = require('@babel/parser')
const traverse = require('@babel/traverse').default
const generate = require('@babel/generator').default

const source = `
    (async function() {
        console.log('hello guangguang');
    })();
`

const ast = parser.parse(source)

traverse(ast, {
  StringLiteral(path) {
    path.node.value = path.node.value.replace('guangguang', 'dongdong')
  }
})

const { code, map } = generate(ast, {
  sourceMaps: true
})

console.log(code)
console.log(JSON.stringify(map))
```

1. æ€ä¹ˆè°ƒè¯•æœ€åˆçš„æºç å‘¢
   sourcemapï¼
   ä½†æ˜¯ä½ å» node_modules ä¸‹çœ‹ä¸‹è¿™äº›åŒ…ï¼Œä¼šå‘ç°å®ƒä»¬å·²ç»æœ‰ sourcemap äº†ï¼Œè€Œä¸”ä¹Ÿå…³è”äº†ï¼š
   é‚£ä¸ºä»€ä¹ˆè°ƒè¯•çš„æ—¶å€™è°ƒè¯•çš„ä¸æ˜¯æºç å‘¢ï¼Ÿ
   è¿™æ˜¯å› ä¸º VSCode çš„ä¸€ä¸ªé»˜è®¤é…ç½®å¯¼è‡´ sourcemap ä¸ä¼šç”Ÿæ•ˆã€‚
   `resolveSourceMapLocations`!
   VSCode Node Debugger é»˜è®¤ä¸ä¼šæŸ¥æ‰¾ node_modules ä¸‹çš„ sourcemapã€‚
2. è™½ç„¶è°ƒè¯•çš„æ˜¯æºç çš„ ts äº†ï¼Œä½†æ˜¯è·¯å¾„æ˜¯ node_modules åŒ…ä¸‹çš„
   æˆ‘ä»¬å¯ä»¥æŠŠ babel é¡¹ç›®ä¸‹ä¸‹æ¥å’Œæµ‹è¯•é¡¹ç›®æ”¾åœ¨ä¸€ä¸ª workspace ä¸‹ï¼Œ`ç„¶åå» node_modules ä¸‹æ‰‹åŠ¨æ›¿æ¢ä¸‹ sourcemap çš„ sources è·¯å¾„`ï¼Œæ¢æˆæœ¬åœ°çš„è·¯å¾„ï¼Œè¿™æ ·å°±å¯ä»¥è°ƒè¯• babel æºç äº†ã€‚
   ç„¶ååœ¨æ–°çš„ workspace åˆ›å»ºä¸ªè°ƒè¯•é…ç½®ï¼Œè¿™æ—¶ç›®å½•æ”¹äº†ï¼Œè¦æŒ‡å®šä¸‹ cwd

## å®æˆ˜æ¡ˆä¾‹ï¼šè°ƒè¯• Vite æºç 

é—®é¢˜ï¼švite è·‘ dev server çš„è¿‡ç¨‹éƒ½æ‰§è¡Œäº†ä»€ä¹ˆé€»è¾‘

1. debug npm script

```json
{
  "name": "Launch via NPM",
  "type": "node",
  "request": "launch",
  "runtimeExecutable": "npm",
  "runtimeArgs": ["run-script", "dev"],
  "console": "integratedTerminal",
  "skipFiles": ["<node_internals>/**"]
}
```

å¯ä»¥è°ƒç”¨æ ˆçœ‹åˆ°è¿™éƒ¨åˆ†ä»£ç æ˜¯ node_modules/vite/dist/node ä¸‹çš„
å» node_modules ä¸‹çœ‹äº†ä¸‹ï¼Œå¹¶æ²¡æœ‰ sourcemapï¼š
é‚£å»å“ªé‡Œæ‰¾ sourcemap å‘¢ï¼Ÿ
è¿™æ—¶å°±åªèƒ½é€šè¿‡æºç  build äº†ã€‚
vite æ˜¯ç”¨ rollup æ‰“åŒ…çš„ï¼Œæ¯ä¸ªåŒ…ä¸‹éƒ½æœ‰ä¸ª rollup.config.ts æ–‡ä»¶ï¼Œ
æœä¸€ä¸‹ sourcemapï¼Œä¼šæ‰¾åˆ°ä¸€ä¸ª createNodeConfig çš„å‡½æ•°ï¼Œè¿™é‡Œå°±æ˜¯é…ç½® node éƒ¨åˆ†çš„ä»£ç æ˜¯å¦ç”Ÿæˆ sourcemap çš„åœ°æ–¹ï¼š
vite ç¼–è¯‘ä¼šç”Ÿæˆä¸‰éƒ¨åˆ†ä»£ç ï¼Œä¸€éƒ¨åˆ†æ˜¯æµè§ˆå™¨é‡Œçš„ï¼Œä¹Ÿå°±æ˜¯ client ç›®å½•ä¸‹çš„ï¼Œä¸€éƒ¨åˆ†æ˜¯ node è·‘çš„ï¼Œæ˜¯ esm çš„æ¨¡å—ï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†æ˜¯ node è·‘çš„ cjs çš„æ¨¡å—ã€‚

## å®æˆ˜æ¡ˆä¾‹ï¼šè°ƒè¯• TypeScript æºç  (ts çš„ä¸€äº›ç‰¹æ€§ï¼Œå¯ä»¥é€šè¿‡æºç æ‰¾ç­”æ¡ˆ)

https://juejin.cn/book/7070324244772716556/section/7137086397147512840?utm_source=profile_book

```ts
type Test<T> = T extends number ? 1 : 2
type res = Test<any>

// ä¸ºä»€ä¹ˆresæ˜¯1|2å‘¢ï¼Ÿ
// è¿™å°±è¦ä»æºç æ‰¾ç­”æ¡ˆäº†!
```

1. ä¸‹è½½æºç 
   lib ç›®å½•ä¸‹æœ‰ `tsc.js` å’Œ `typescript.js`ï¼Œè¿™ä¸¤ä¸ªåˆ†åˆ«æ˜¯ ts çš„å‘½ä»¤è¡Œå’Œ api çš„å…¥å£
   ä½†æ˜¯ï¼Œè¿™äº›æ˜¯ç¼–è¯‘ä»¥åçš„ js ä»£ç ï¼Œæºç åœ¨ src ä¸‹ï¼Œæ˜¯ç”¨ ts å†™çš„ã€‚
   æ€ä¹ˆæŠŠç¼–è¯‘åçš„ js ä»£ç å’Œ ts æºç å…³è”èµ·æ¥å‘¢ï¼Ÿ sourcemapï¼
2. æ‰“æ–­ç‚¹
   ts ä»£ç å¤ªå¤šäº†ï¼Œä¸çŸ¥é“å“ªäº›æ˜¯è§£æç±»å‹çš„é€»è¾‘ï¼Œåœ¨å“ªé‡Œæ‰“æ–­ç‚¹æ¯”è¾ƒå¥½ã€‚
   `è¿™ç§æƒ…å†µè¿˜æ˜¯ç”¨ api çš„æ–¹å¼è°ƒè¯•æ¯”è¾ƒå¥½ã€‚`

   ```js
   const ts = require('./built/local/typescript')

   const filename = './input.ts'
   const program = ts.createProgram([filename], {
     allowJs: false,
     strictNullChecks: true
   })

   const ast = program.getSourceFile(filename) // æƒ³çŸ¥é“ä»£ç å“ªéƒ¨åˆ†æ˜¯ä»€ä¹ˆ AST å¯ä»¥é€šè¿‡ astexplorer.net æ¥æŸ¥çœ‹
   const typeChecker = program.getTypeChecker()

   function visitNode(node) {
     if (node.kind === ts.SyntaxKind.TypeAliasDeclaration && node.name.escapedText === 'res') {
       const type = typeChecker.getTypeFromTypeNode(node.name)

       console.log(type)
     }

     node.forEachChild(child => visitNode(child))
   }

   visitNode(ast)
   ```

   ![alt text](image-7.png)
   é€šè¿‡è¿ç”¨ ts çš„ api å»è°ƒè¯• ts ä¼šæ¯”ç›´æ¥è°ƒè¯•æºç ç®€å•ï¼Œå¦‚æœæ¡ä»¶ç±»å‹å·¦è¾¹æ˜¯ any æ—¶ä¼šä½œä¸ºè”åˆç±»å‹å¤„ç†

## å¦‚ä½•é€šè¿‡å˜é‡å†™å‡ºæ›´çµæ´»çš„è°ƒè¯•é…ç½®ï¼Ÿ

vscode çš„ debug é…ç½®å˜é‡æ”¯æŒå˜é‡

- input å˜é‡ï¼Œå¯ä»¥è®©**ç”¨æˆ·è¾“å…¥æˆ–è€…é€‰æ‹©**ï¼Œé€šè¿‡ ${input:xxx} è¯­æ³•
  ä¾‹å¦‚ï¼š"${input:port}" -> è¾“å…¥ä¸€ä¸ªç«¯å£å·
- env å˜é‡ï¼Œå¯ä»¥è¯»å–**ç¯å¢ƒå˜é‡**å€¼ï¼Œé€šè¿‡ ${env:xxx} è¯­æ³•
  ä¾‹å¦‚ï¼š"${env:HOME}" -> å– HOME ç¯å¢ƒå˜é‡
- config å˜é‡ï¼Œå– **vscode çš„é…ç½®**ï¼Œé€šè¿‡ ${config:xxx} è¯­æ³•
  ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡ ${config:launch.nodePath} æ¥å– launch é…ç½®é‡Œçš„ nodePath
- command å˜é‡ï¼Œå¯ä»¥**è¯»å–å‘½ä»¤æ‰§è¡Œç»“æœ**ï¼Œé€šè¿‡ ${command: xxx} è¯­æ³•
  ä¾‹å¦‚ï¼š"${command:extension.pickNodeProcess}" -> é€‰æ‹©ä¸€ä¸ª node è¿›ç¨‹
- å†…ç½®å˜é‡ï¼Œå¯ä»¥å–å½“å‰æ–‡ä»¶ã€ç›®å½•ç­‰ä¿¡æ¯ï¼Œé€šè¿‡ ${xxx} è¯­æ³•
  ä¾‹å¦‚ï¼š${file}ã€${workspaceFolder}ã€${relativeFile}ã€${fileBasename}ã€${fileDirname}ã€${fileExtname}ã€${cwd}

  çµæ´»è¿ç”¨è¿™äº›å˜é‡ï¼Œå¯ä»¥è®©è°ƒè¯•é…ç½®æ›´çµæ´»ã€‚

## å¦‚ä½•çµæ´»çš„è°ƒè¯• Jest æµ‹è¯•ç”¨ä¾‹

- å¦‚æœåªæ˜¯æƒ³è·‘æŸä¸ªæµ‹è¯•æ–‡ä»¶çš„ç”¨ä¾‹: jest åé¢åŠ ä¸Šè¦è·‘çš„æµ‹è¯•æ–‡ä»¶çš„å°±è¡Œ
- å¦‚æœæƒ³è·‘æŸä¸ªæµ‹è¯•ç”¨ä¾‹: jest åé¢åŠ ä¸Š -t å‚æ•°ï¼Œç„¶ååŠ ä¸Šè¦è·‘çš„æµ‹è¯•ç”¨ä¾‹çš„åå­—ã€‚-t æ˜¯ --testNamePattern çš„ç¼©å†™ï¼Œå¯ä»¥æŒ‡å®šè¦è·‘çš„ç”¨ä¾‹åçš„æ­£åˆ™ã€‚

1. è·‘ jest æ€ä¹ˆè·‘å‘¢ï¼Ÿ
   å…¶å®æˆ‘ä»¬è·‘ jest æœ€ç»ˆæ‰§è¡Œçš„æ˜¯ node_modules/jest/bin/jest.js è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥è°ƒè¯•çš„æ—¶å€™å°±ç›´æ¥ç”¨ node è·‘è¿™ä¸ªæ–‡ä»¶ï¼Œä¼ å…¥å‚æ•°å°±è¡Œã€‚
   è¿˜è¦æŒ‡å®šæ—¥å¿—è¾“å‡ºä½ç½®ä¸ºå†…ç½®çš„ç»ˆç«¯ï¼Œä¹Ÿå°±æ˜¯ console ä¸º integratedTerminalã€‚
   ![alt text](image-8.png)
   ä½†ä½ ä¼šå‘ç°å®ƒè·‘äº†å¤šä¸ª woker è¿›ç¨‹ï¼Œæ¯ä¸ªç”¨ä¾‹ä¸€ä¸ªï¼Œè¿™æ˜¯ jest ä¼˜åŒ–æ€§èƒ½çš„æ–¹å¼ã€‚
   ä½†è°ƒè¯•çš„æ—¶å€™å¯ä»¥ä¸ç”¨è¿™ç§ä¼˜åŒ–ï¼Œç›´æ¥åœ¨ä¸»è¿›ç¨‹è·‘å°±è¡Œã€‚
   å¯ä»¥åŠ ä¸ª -i çš„å‚æ•°ï¼š
   -i æ˜¯ `--runInBand` çš„ç¼©å†™ï¼Œè¿™ä¸ªå‚æ•°çš„æ„æ€æ˜¯ä¸å†ç”¨ worker è¿›ç¨‹å¹¶è¡Œè·‘æµ‹è¯•ç”¨ä¾‹ï¼Œè€Œæ˜¯åœ¨å½“å‰è¿›ç¨‹ä¸²è¡Œè·‘ï¼š
   ä½†è¿™æ ·æ¯è°ƒè¯•ä¸€ä¸ªç”¨ä¾‹éƒ½å¾—æ”¹ä¸‹é…ç½®ä¹Ÿå¤ªéº»çƒ¦äº†ï¼Œèƒ½ä¸èƒ½æˆ‘æ‰“å¼€å“ªä¸ªæ–‡ä»¶ï¼Œå°±è·‘å“ªä¸ªæ–‡ä»¶çš„ç”¨ä¾‹å‘¢ï¼Ÿ
   å¯ä»¥çš„ã€‚
   VSCode è°ƒè¯•é…ç½®æ”¯æŒå˜é‡ï¼Œæ¯”å¦‚ ${file} å°±ä»£è¡¨å½“å‰æ–‡ä»¶ã€‚
   è¿™æ ·å°±å¯ä»¥æ‰“å¼€å“ªä¸ªè°ƒè¯•é‚£ä¸ªäº†ã€‚
   é‚£æƒ³æŒ‡å®šå…·ä½“çš„æµ‹è¯•ç”¨ä¾‹å‘¢ï¼Ÿ
   **vscode è¿˜æ”¯æŒè¾“å…¥ç±»å‹çš„å˜é‡ã€‚**
2. jest-runner VSCode æ’ä»¶ åŸç†
   å®ƒä¼šåœ¨æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹æ—è¾¹åŠ ä¸€ä¸ªè¿è¡Œå’Œè°ƒè¯•çš„æŒ‰é’®ï¼š
   ç‚¹å‡»ä¸åŒä½ç½®çš„ debugï¼Œå°±æ˜¯è·å–æ–‡ä»¶åå’Œç”¨ä¾‹åä¼ å…¥è°ƒè¯•é…ç½®
   ç›¸æ¯”ç¬¬ä¸‰æ–¹çš„ Jest æ’ä»¶ï¼Œè‡ªå·±å†™è°ƒè¯•é…ç½®æ˜æ˜¾çµæ´»ã€å¼ºå¤§çš„å¤š(ä¾‹å¦‚æ­£åˆ™)ã€‚

## 7 ç§æ–­ç‚¹(breakpoint)

è¿™é‡Œåªè®°å½• 3 ç§ chrome devtools çš„ source é¢æ¿çš„

- dom æ–­ç‚¹
  ![alt text](image-9.png)
  æœ‰ä¸‰ç§ç±»å‹ï¼Œ`å­æ ‘ä¿®æ”¹çš„æ—¶å€™æ–­ä½`ã€å±æ€§ä¿®æ”¹çš„æ—¶å€™æ–­ä½ã€èŠ‚ç‚¹åˆ é™¤çš„æ—¶å€™æ–­ä½ã€‚
  è¿™æ—¶å€™ä½ ä¼šå‘ç°ä»£ç åœ¨ä¿®æ”¹ DOM çš„åœ°æ–¹æ–­ä½äº†ï¼Œ**è¿™å°±æ˜¯ React æºç é‡Œæœ€ç»ˆæ“ä½œ DOM çš„åœ°æ–¹ï¼Œçœ‹ä¸‹è°ƒç”¨æ ˆå°±çŸ¥é“ setState ä¹‹åæ˜¯å¦‚ä½•æ›´æ–° DOM çš„äº†ã€‚**
- Event Listener æ–­ç‚¹ (äº‹ä»¶æ–­ç‚¹)
  ä¹‹å‰æˆ‘ä»¬æƒ³è°ƒè¯•äº‹ä»¶å‘ç”Ÿä¹‹åçš„å¤„ç†é€»è¾‘ï¼Œéœ€è¦æ‰¾åˆ°äº‹ä»¶ç›‘å¬å™¨ï¼Œç„¶åæ‰“ä¸ªæ–­ç‚¹ã€‚
  æ‰“å¼€ sources é¢æ¿ï¼Œå°±å¯ä»¥æ‰¾åˆ°äº‹ä»¶æ–­ç‚¹ï¼Œæœ‰å„ç§ç±»å‹çš„äº‹ä»¶ï¼š
  ![alt text](image-11.png)
- url è¯·æ±‚æ–­ç‚¹
  å½“ä½ æƒ³åœ¨æŸä¸ªè¯·æ±‚å‘é€çš„æ—¶å€™æ–­ä½ï¼Œä½†ä½ ä¸çŸ¥é“åœ¨å“ªé‡Œå‘çš„ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ç”¨ url è¯·æ±‚æ–­ç‚¹
  ![alt text](image-12.png)
  ä¸è¾“å…¥å†…å®¹å°±æ˜¯åœ¨ä»»ä½•è¯·æ±‚å¤„æ–­ä½ï¼Œä½ å¯ä»¥å¯ä»¥è¾“å…¥å†…å®¹ï¼Œé‚£ä¼šåœ¨ url åŒ…å«è¯¥å†…å®¹çš„è¯·æ±‚å¤„æ–­ä½ï¼š

## å®æˆ˜æ¡ˆä¾‹ï¼šè°ƒè¯• Ant Design ç»„ä»¶æºç 

1. åœ¨ç»„ä»¶é‡Œæ‰“ä¸ªæ–­ç‚¹ï¼Œä»£ç ä¼šåœ¨è¿™é‡Œæ–­ä½
2. åœ¨è°ƒç”¨æ ˆé‡Œæ‰¾åˆ°`renderWithHooks`ï¼Œè¿™æ˜¯ react æºç é‡Œè°ƒç”¨å‡½æ•°ç»„ä»¶çš„åœ°æ–¹
3. æ‰€æœ‰å‡½æ•°ç»„ä»¶éƒ½æ˜¯åœ¨è¿™é‡Œè¢«è°ƒç”¨çš„ï¼Œ`è€Œ antd çš„ç»„ä»¶ä¹Ÿå…¨éƒ¨æ˜¯å‡½æ•°ç»„ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨è¿™é‡ŒåŠ ä¸ªæ–­ç‚¹ï¼Œæ‰“åå­—ä¸º Button çš„å‡½æ•°ç»„ä»¶è¢«è°ƒç”¨çš„æ—¶å€™æ–­ä½ä¸å°±è¡Œäº†ï¼Ÿ`
   å³é”®é€‰æ‹©æ·»åŠ æ¡ä»¶æ–­ç‚¹ï¼šå½“ç»„ä»¶åå­—åŒ…å« Button çš„æ—¶å€™æ‰æ–­ä½ã€‚
   ![alt text](image-13.png)
4. InternalButton åœ¨è¿™é‡Œæ–­ä½äº†ã€‚
   è¿™ä¸ª InternalButton å°±æ˜¯ antd é‡Œçš„ Button ç»„ä»¶ã€‚
5. step into è¿›å…¥å‡½æ•°å†…éƒ¨
   ä½ ä¼šå‘ç°è¿™ç¡®å®æ˜¯ Button ç»„ä»¶çš„æºç ï¼Œä½†å´æ˜¯è¢«ç¼–è¯‘åçš„ï¼Œæ¯”å¦‚ jsx éƒ½è¢«ç¼–è¯‘æˆäº† React.createElementï¼š
   è¿™æ ·æ˜¯å¯ä»¥è°ƒè¯• Button ç»„ä»¶æºç çš„ï¼Œä½†æ˜¯æ¯”è¾ƒåˆ«æ‰­ã€‚
   é‚£èƒ½ä¸èƒ½ç›´æ¥è°ƒè¯• Button ç»„ä»¶å¯¹åº”çš„ tsx æºç å‘¢ï¼Ÿ
   å¯ä»¥çš„ï¼Œè¿™å°±è¦ç”¨åˆ° sourcemap äº†ã€‚
   ```bash
   git clone --depth=1 --single-branch git@github.com:ant-design/ant-design.git
   ```
   --single-branch æ˜¯ä¸‹è½½å•ä¸ªåˆ†æ”¯ï¼Œ --depth=1 æ˜¯ä¸‹è½½å•ä¸ª commitï¼Œ è¿™æ ·é€Ÿåº¦ä¼šå¿«å‡ åå€
6. ä½†ä½ ä¼šå‘ç° package.json ä¸­æœ‰ build å‘½ä»¤ï¼Œæœ‰ dist å‘½ä»¤ï¼Œè¯¥æ‰§è¡Œå“ªä¸ªå‘¢ï¼Ÿ
   è¿™ä¸ªå°±éœ€è¦äº†è§£ä¸‹ antd çš„å‡ ç§å…¥å£äº†ã€‚
   å» react é¡¹ç›®çš„ node_modules ä¸‹ï¼Œæ‰¾åˆ° antd çš„ package.json çœ‹ä¸€ä¸‹ï¼Œä½ ä¼šå‘ç°å®ƒæœ‰ä¸‰ç§å…¥å£ï¼š
   ![alt text](image-14.png)
   main æ˜¯ commonjs çš„å…¥å£ï¼Œä¹Ÿå°±æ˜¯ require('antd') çš„æ—¶å€™ä¼šèµ°è¿™ä¸ªã€‚
   module æ˜¯ esm çš„å…¥å£ï¼Œä¹Ÿå°±æ˜¯ import xx from 'antd' çš„æ—¶å€™ä¼šèµ°è¿™ä¸ªã€‚
   unpkg æ˜¯ UMD çš„å…¥å£ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ script æ ‡ç­¾å¼•å…¥çš„æ—¶å€™æˆ–è€… commonjs çš„æ–¹å¼ç­‰éƒ½å¯ä»¥ç”¨ã€‚
   åˆ†åˆ«å¯¹åº”äº† libã€esã€dist çš„ç›®å½•ã€‚
   `æ‰€ä»¥ antd é¡¹ç›®é‡Œçš„ dist å‘½ä»¤å°±æ˜¯å•ç‹¬ç”Ÿæˆ UMD ä»£ç çš„ï¼Œè€Œ build å‘½ä»¤æ˜¯ç”Ÿæˆè¿™ä¸‰ç§ä»£ç ã€‚`
7. é‚£ç›´æ¥ç”¨ dist å…¥å£çš„ä»£ç å°±èƒ½è°ƒè¯•æºç äº†ä¹ˆï¼Ÿ
   æŠŠå¼•å…¥ç»„ä»¶çš„åœ°æ–¹æ¢æˆ dist ç›®å½•ä¸‹ï¼Œä¹Ÿå°±æ˜¯ç”¨ UMD å½¢å¼çš„å…¥å£ã€‚
   é‡æ–°è·‘è°ƒè¯•ï¼š
   ä½ ä¼šå‘ç°ä»£ç ç¡®å®æ¯”ä¹‹å‰æ›´åƒæºç äº†ã€‚
8. ä¹Ÿå°±æ˜¯æ²¡äº† babel runtime çš„ä»£ç ï¼Œè¿™æ˜æ˜¾æ˜¯æºç äº†ã€‚
   `ä½†æ˜¯ä¾ç„¶è¿˜æ˜¯ React.createElementï¼Œè€Œä¸æ˜¯ jsxï¼Œä¹Ÿæ²¡æœ‰ ts çš„ä»£ç ã€‚`è¯´æ˜å®ƒè¿˜ä¸æ˜¯æœ€åˆçš„æºç ã€‚
   ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æ—¢æ˜¯æºç åˆä¸æ˜¯æºç çš„æƒ…å†µå‘¢ï¼Ÿ
   **ç¼ºå°‘ loader çš„ sourcemap!**

   å› ä¸ºå®ƒçš„ç¼–è¯‘æµç¨‹æ˜¯è¿™æ ·çš„ï¼š
   ![alt text](image-15.png)
   Button.tsx --tsc -> Button.js --babel -> Button.js --webpack -> bundle.js
   tsc å’Œ babel çš„ç¼–è¯‘éƒ½ä¼šç”Ÿæˆ sourcemapï¼Œè€Œ webpack ä¹Ÿä¼šç”Ÿæˆä¸€ä¸ª sourcemap
   webpack çš„ sourcemap é»˜è®¤åªä¼šæ ¹æ®æœ€åä¸€ä¸ª loader çš„ sourcemap æ¥ç”Ÿæˆã€‚
   æ‰€ä»¥æƒ³æ˜ å°„å›æœ€åˆçš„ tsx æºç ï¼Œåªè¦å…³è”äº†æ¯ä¸€çº§ loader çš„ sourcemap å°±å¯ä»¥äº†(`ä¹Ÿå°±æ˜¯tscå’Œbabelçš„sourcemap`)ã€‚è€Œè¿™ä¸ªæ˜¯å¯ä»¥é…ç½®çš„ï¼Œå°±æ˜¯ devtoolã€‚

9. æ”¹ç¼–è¯‘é…ç½®ï¼Œsourcemap ç›´æ¥é¡¶é…
   antd çš„ç¼–è¯‘å·¥å…·é“¾åœ¨ @ant-design/tools è¿™ä¸ªåŒ…é‡Œï¼Œä» antd/node_modules/@antd-design/tools/lib/getWebpackConfig.js å°±å¯ä»¥æ‰¾åˆ° webpack çš„é…ç½®
10. æ”¹ webpack çš„ devtoolï¼š
    æœä¸€ä¸‹ ts-loaderï¼Œä½ å°±ä¼šçœ‹åˆ°è¿™æ®µé…ç½®ï¼š
    ![alt text](image-16.png)
    ç¡®å®å°±åƒæˆ‘ä»¬åˆ†æçš„ï¼Œtsx ä¼šç»è¿‡ ts-loader å’Œ babel-loader çš„å¤„ç†ã€‚
    æœä¸€ä¸‹ devtoolï¼Œä½ ä¼šå‘ç°**å®ƒçš„é…ç½®æ˜¯ source-mapï¼š**
    è¿™å°±æ˜¯ antd è™½ç„¶æœ‰ sourcemapï¼Œä½†æ˜¯å…³è”ä¸åˆ° tsx æºç çš„åŸå› (æ²¡å¸¦`module`)ã€‚
    é‚£æˆ‘ä»¬ç»™å®ƒæ”¹ä¸€ä¸‹ï¼š
    æŠŠ devtool æ”¹ä¸º cheap-`module`-source-mapï¼Œå…³è” loader çš„ sourcemap
11. æ”¹ babelï¼šå¹¶ä¸”æ”¹ä¸€ä¸‹ babel é…ç½®ï¼Œè®¾ç½® sourceMap ä¸º trueï¼Œè®©å®ƒç”Ÿæˆ sourcemap
12. æ”¹ tsï¼šts ä¹ŸåŒæ ·è¦ç”Ÿæˆ sourcemapï¼Œä¸è¿‡é‚£ä¸ªæ˜¯åœ¨æ ¹ç›®å½•çš„ tsconfig.json é‡Œæ”¹
13. é‡æ–° buildï¼ŒæŠŠå®ƒå¤åˆ¶åˆ° react é¡¹ç›®çš„ node_modules/antd/dist ä¸‹ï¼Œè¦†ç›–ä¹‹å‰çš„
14. æ¸…ä¸€ä¸‹ babel-loader çš„ç¼“å­˜ï¼Œåˆ é™¤æ•´ä¸ª .cache ç›®å½•
15. æœ‰çš„åŒå­¦å¯èƒ½ä¼šæ‹…å¿ƒ node_modules ä¸‹çš„æ”¹åŠ¨ä¿å­˜ä¸ä¸‹æ¥ã€‚
    è¿™ä¸ªä¹Ÿä¸æ˜¯é—®é¢˜ï¼Œå¯ä»¥æ‰§è¡Œä¸‹ npx patch-package antdï¼Œä¼šç”Ÿæˆè¿™æ ·ä¸€ä¸ª patch æ–‡ä»¶:

## å®æˆ˜æ¡ˆä¾‹ï¼šè°ƒè¯• ElementUI ç»„ä»¶æºç 
