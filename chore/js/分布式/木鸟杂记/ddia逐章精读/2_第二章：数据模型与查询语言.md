# 第二章：数据模型与查询语言

## 概要

如何分析一个数据模型：
数据基本元素，和元素之间的`对应关系`（一对多，多对多）
（最为流行的）关系模型，（树状的）文档模型，（极大自由度的）图模型。
强 Schema（写时约束）；弱 Schema（读时解析）

如何考量查询语言：
如何与数据模型关联、匹配
声明式（declarative）和命令式（imperative）

- 数据模型
  数据模型：如何组织数据，如何标准化关系，如何关联现实。
  ![alt text](image-1.png)
  每层模型核心问题：**如何用下一层的接口来对本层进行建模？**

  1. 作为应用开发者， 你将现实中的具体问题抽象为一组对象、数据结构（data structure） 以及作用于其上的 API。
  2. 作为数据库管理员（DBA），为了持久化上述数据结构，你需要将他们表达为通用的数据模型（data model），如文档数据库中的 XML/JSON、关系数据库中的表、图数据库中的图。
  3. 作为数据库系统开发者，你需要将上述数据模型组织为内存中、硬盘中或者网络中的字节（Bytes） 流，并提供多种操作数据集合的方法。
  4. 作为硬件工程师，你需要将字节流表示为二极管的电位（内存）、磁场中的磁极（磁盘）、光纤中的光信号（网络）。

  `在每一层，通过对外暴露简洁的数据模型，我们隔离和分解了现实世界的复杂度。`

  好的数据模型需有两个特点：简洁直观；具有组合性

## 关系模型与文档模型

- 关系模型
  当今最流行的数据库模型
  将数据以关系呈现给用户（比如：一组包含行列的二维表），提供操作数据集合的`关系算子`
- NoSQL 的诞生
  不同于传统的关系数据库的数据库管理系统的统称
  MongoDB，Redis，ElasticSearch，Cassandra
- 面向对象和关系模型的不匹配
  关系模型很难直观的表示`一对多`的关系
  文档模型使用 Json 和 XML 的天然嵌套，关系模型使用 SQL 模型，将职位、教育单拎一张表，然后在用户表中使用外键关联。
- 多对一和多对多
  region 在存储时，为什么不直接存储纯字符串：“Greater Seattle Area”，而是先存为 region_id → region name，其他地方都**引用 region_id？**

  易于修改、查询、本地化支持；类似的概念还有：面向抽象编程，而非面向细节。
  **ID 对人类是无意义的，无意义的意味着不会随着现实世界的将来的改变而改动。**

  这在关系数据库表设计时需要考虑，即如何控制冗余（duplication）。会有几种范式（normalization） 来消除冗余。

  `文档型数据库很擅长处理一对多的树形关系，却不擅长处理多对多的图形关系`。如果其不支持 Join，则处理多对多关系的复杂度就从数据库侧移动到了应用侧。

- 文档模型是否在重复历史？
  在关系模型中，数据被组织成元组（tuples），进而集合成关系（relations）；在 SQL 中分别对应行（rows）和表（tables）。
  提供了一种`声明式`的描述数据和构建查询的方法，将逻辑和实现解耦。
- 文档型 vs 关系型
  ![alt text](image-2.png)

## 数据查询语言

- 数据库以外：Web 中的声明式

- MapReduce 查询

## 图模型

- 基本概念

- 属性图（PG，Property Graphs）

- Cypher 查询语言

- 使用 SQL 进行图查询

- Triple-Stores and SPARQL

- 查询语言前驱：Datalog

- 参考
