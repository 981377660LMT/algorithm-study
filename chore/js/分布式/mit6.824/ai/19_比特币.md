## 比特币

### 核心观点

比特币是一个革命性的去中心化数字货币系统，其核心是解决在没有中央权威（如银行）的情况下，如何防止`“双重支付”`（Double Spending）这一根本性难题。它的解决方案是一个名为**区块链（Blockchain）**的公共账本，以及一个名为**工作量证明（Proof-of-Work）**的共识机制。其精髓在于：它不依赖于对任何参与者的信任，而是通过让所有参与者共同维护一个由密码学链接起来的、不可篡改的交易记录链，并引入一种计算成本高昂的“挖矿”过程来决定谁有权添加下一个记录。这个过程本质上是一种基于算力的“投票”，确保了除非攻击者掌握了全网一半以上的计算能力，否则无法篡改历史或双花一笔钱。最终，系统通过一个简单的“**最长链原则**”来解决偶发的冲突，使得整个网络能够自主地、无需协调地对唯一的交易历史达成共识。

---

### 逻辑梳理

#### 1. 根本问题：去中心化环境下的双重支付

- **中心化方案（被比特币拒绝）：** 最简单的方案是设立一个可信的中央服务器（像银行一样）来记录所有交易。但比特币的目标是建立一个无需信任任何单一实体的全球系统。
- **去中心化挑战：** 在一个开放的、任何人都可以加入的网络中，如果一个恶意用户 Y 试图将同一笔钱同时支付给 Z 和 Q，网络中的不同节点（Peers）会收到相互冲突的交易。
- **为何简单投票行不通？**
  - 我们无法知道网络中总共有多少参与者，因此无法定义“多数派”。
  - 更重要的是，攻击者可以轻易地创建无数个虚假身份（称为“女巫攻击”或 Sybil Attack），从而伪造多数票。

#### 2. 比特币的解决方案：区块链 + 工作量证明

比特币将问题分解为两个部分：一个防篡改的数据结构，和一个决定谁来写入这个数据结构的机制。

1.  **数据结构：区块链 (Blockchain)**

    - **是什么：** 一个由“区块”（Block）组成的链条。
    - **区块内容：** 每个区块包含了一批交易、一个随机数（Nonce），以及最关键的——**前一个区块的哈希值**。
    - **防篡改特性：** 这种设计使得所有区块通过密码学环环相扣。如果有人试图修改历史上的任何一个区块（比如删除一笔交易），该区块的哈希值就会改变，从而导致其后所有区块的链接全部失效。这使得篡改变得极其容易被发现。

2.  **共识机制：工作量证明 (Proof-of-Work)，即“挖矿” (Mining)**
    - **目标：** 公平、抗女巫攻击地决定由谁来创建下一个区块。
    - **机制：**
      1.  想要创建新区块的节点（矿工）必须解决一个计算上非常困难的难题。
      2.  这个难题是：不断地尝试不同的随机数（Nonce），直到整个区块的哈希值满足一个特定条件（例如，以特定数量的零开头）。
      3.  这是一个纯粹的暴力破解过程，没有捷径。找到正确 Nonce 的概率与投入的**计算能力（算力）**成正比。
    - **效果：**
      - **抗女巫攻击：** 创建虚假身份是免费的，但获取真实的算力是昂贵的。这使得共识机制从“一人一票”变成了“一 CPU 一票”，有效抵御了攻击。
      - **随机选择记账权：** 全网所有矿工同时竞争，第一个解出难题的矿工获得了创建下一个区块的权利，并向全网广播。
      - **控制出块速度：** 系统会自动调整难题的难度，使得平均每 10 分钟才会有一个新区块被创建。

#### 3. 解决冲突：最长链原则 (Longest Chain Rule)

由于网络延迟，可能会有两个矿工在几乎同一时间都找到了有效的区块，从而导致区块链出现**分叉 (Fork)**。

- **场景：** 区块链在区块 6 之后，同时出现了两个都合法的区块 7' 和 7''。一部分网络节点看到了 7'，另一部分看到了 7''。
- **解决方案：最长链原则**
  1.  当分叉出现时，诚实的矿工会基于他们**首先看到**的那个区块继续挖矿。
  2.  由于挖矿成功具有随机性，其中一个分叉很可能会比另一个分叉**先**产生下一个区块（例如，7' 后面出现了区块 8）。
  3.  此时，`... -> 7' -> 8` 这条链就比 `... -> 7''` 这条链更长。
  4.  所有诚实的节点，包括之前在 7'' 上挖矿的节点，都会遵循“**永远在最长的链上工作**”这一核心规则，立即放弃较短的链，转而到最长的链上继续挖矿。
- **效果：** 分叉是暂时的。通过最长链原则，网络会迅速地自动收敛到单一的、公认的历史上。被抛弃的短分叉上的交易则被视为无效。

#### 4. 安全性与最终性 (Finality)

- **概率性最终性：** 由于最长链原则，一笔交易刚刚被写入最新区块时，并不能 100% 保证它是最终的，因为它可能位于一个最终会被抛弃的短分叉上。
- **等待确认：** 交易的安全性随着其后增长的区块数量而指数级增加。通常认为，当一笔交易后面跟了 6 个新区块（约 1 小时）后，它被推翻的可能性就变得微乎其微。这就是为什么大额交易需要“等待多个确认”的原因。
- **51% 攻击：** 唯一能系统性地推翻交易历史的方法是，攻击者掌握了全网超过 50% 的算力。这样他就能私下挖出一条比主链更长的“攻击链”，并随时发布它来取代主链，从而实现双重支付。这是比特币系统的根本安全假设——没有单一实体能控制多数算力。
