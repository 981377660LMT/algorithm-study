```markdown
# 线性哈希（Linear Hashing）详解

## 一、基本概念

线性哈希是由Witold Litwin在1980年提出的动态哈希方法，允许哈希表随着数据量增长而平滑扩展，无需一次性重建整个表结构。其核心特点是：

- 维护一个指向"下一个要分裂的桶"的指针
- 根据**全局条件**（不一定是某个特定桶溢出）触发分裂
- 使用多个哈希函数处理不同阶段的桶
- 按顺序分裂桶，实现线性增长

## 二、核心组件

1. **桶（Bucket）**：存储键值对的容器
2. **分裂指针（Split Pointer）**：指向下一个要分裂的桶
3. **哈希函数族**：h₀, h₁, h₂, ...，每个函数范围依次翻倍
   - h₀(key) = key % N
   - h₁(key) = key % (2N)
   - h₂(key) = key % (4N)
4. **级别（Level）**：当前哈希表的扩展轮次

## 三、操作流程详解

### 初始状态

- 起始有N个桶（通常N=2^m）
- 使用h₀函数，范围是[0, N-1]
- 分裂指针指向桶0

### 插入过程

1. 计算键的哈希值
2. 确定目标桶：
   - 如果 h₀(key) < 分裂指针：使用 h₁(key)
   - 否则：使用 h₀(key)
3. 将键值对放入确定的桶
4. 如果触发分裂条件（如负载因子过高）：
   - 分裂"分裂指针"指向的桶（注意：不一定是刚插入的桶）
   - 创建新桶，编号为N+分裂指针
   - 重新分配原桶中的数据
   - 分裂指针前进：sp = (sp + 1) % N
   - 如果分裂指针回到0，完成一轮分裂：
     - 级别+1
     - N值翻倍
     - 开始使用下一级哈希函数

### 实例演示

假设：

- 初始N=4（桶0,1,2,3）
- 每桶容量=2项
- 分裂指针=0

1. **插入导致溢出**：

   - 当某个桶溢出时，我们不管溢出的是哪个桶，总是分裂指针指向的桶
   - 创建新桶4，分裂桶0中的数据
   - 分裂指针移动到1

2. **查找过程**：

   - 要查找键k：
     - 如果h₀(k) < 1（即k%4 = 0），使用h₁(k)=k%8
     - 否则使用h₀(k)=k%4

3. **继续分裂**：
   - 随着更多数据插入，依次分裂桶1,2,3
   - 分裂指针最终回到0，完成一轮分裂
   - 此时桶数量从4增加到8
   - 开始使用h₁作为主哈希函数，h₂作为溢出桶的哈希函数

## 四、特点与优势

### 优点

1. **平滑增长**：避免了可扩展哈希中目录可能突然翻倍的问题
2. **无目录开销**：不需要维护额外的目录结构
3. **预定义分裂顺序**：分裂是按预定义顺序进行，不依赖于特定桶的溢出
4. **空间利用率高**：可以根据整体负载控制分裂时机
5. **并发友好**：分裂操作只影响两个桶，其余桶可并行访问

### 缺点

1. **查找复杂度**：需要额外计算确定使用哪个哈希函数
2. **分裂不针对性**：即使严重溢出的桶不是分裂指针指向的桶，也按顺序分裂
3. **需要溢出处理**：数据不均匀分布时，可能需要溢出链

## 五、溢出处理策略

当桶溢出但尚未被分裂指针指向时，使用以下策略：

1. **溢出链**：为溢出的桶创建溢出页面链接到主桶
2. **提前分裂**：在特定条件下允许非顺序分裂
3. **临时扩容**：允许桶暂时超过其标准容量

## 六、分裂触发条件

线性哈希可使用不同标准决定何时触发分裂：

1. **空间利用率**：整个哈希表填充率超过阈值（如70%）
2. **溢出链长度**：平均溢出链长度过长
3. **定期分裂**：每插入K个元素分裂一次

## 七、应用场景

- **数据库索引**：作为哈希索引的实现基础
- **内存缓存系统**：高效处理动态增长的缓存
- **文件系统**：用于管理大型文件系统的目录结构
- **分布式系统**：在需要动态扩展的分布式哈希表中

线性哈希在数据库系统中特别有用，因为它提供了可预测的性能，并且在数据增长过程中保持了良好的空间利用率，同时避免了昂贵的全局重组操作。
```
