# 可扩展哈希（Extendible Hashing）详解

## 一、基本概念

可扩展哈希是一种动态哈希方案，解决了传统哈希表增长问题，特别适合数据库系统使用。它的核心思想是：

- 采用链式哈希的改进方案，在桶链过长时进行分裂
- 允许多个槽位指向同一个桶
- 通过调整索引比特数量，实现增量式的哈希表扩展

## 二、核心数据结构

1. **目录（Directory）**：

   - 包含2^d个指针，d为全局深度
   - 每个指针指向一个桶
   - 多个目录项可能指向同一个桶

2. **桶（Bucket）**：

   - 存储实际键值对
   - 每个桶有固定容量和局部深度
   - 局部深度≤全局深度

3. **全局深度（Global Depth）**：

   - 表示使用哈希值的前多少位来索引目录
   - 决定目录大小：2^(全局深度)

4. **局部深度（Local Depth）**：
   - 表示区分该桶内记录所需的最少位数
   - 当桶分裂时局部深度加1

## 三、详细操作流程

### 查找操作

1. 计算键的哈希值
2. 提取哈希值的前d位（d为全局深度）
3. 使用这些位作为目录索引
4. 访问对应桶并在其中线性搜索键

### 插入操作

1. 计算键的哈希值并找到对应桶
2. 如果桶未满，直接插入
3. **如果桶已满，执行分裂操作**：
   - **情况1**: 局部深度 < 全局深度
     - 创建新桶，局部深度+1
     - 根据哈希值第(局部深度)位重新分配桶中记录
     - 更新目录，让一半指向原桶，一半指向新桶
   - **情况2**: 局部深度 = 全局深度
     - 全局深度+1，目录大小翻倍
     - 复制原目录指针到新增部分
     - 然后执行情况1的分裂过程

### 实例演示

假设初始状态：

- 全局深度=2（4个目录项）
- 每桶容量=2条记录
- 三个桶，局部深度分别为1,2,2

目录结构:

```

00 → 桶0 (局部深度=1): 包含哈希值前缀为00和01的记录
01 → 桶0 (同上)
10 → 桶1 (局部深度=2): 包含哈希值前缀为10的记录
11 → 桶2 (局部深度=2): 包含哈希值前缀为11的记录

```

如果插入一个哈希值前缀为00的记录，导致桶0溢出:

1. 桶0分裂为桶0和桶3
2. 局部深度从1增加到2
3. 重新分配记录：前缀00→桶0，前缀01→桶3
4. 更新目录指针：

```

00 → 桶0 (局部深度=2): 包含哈希值前缀为00的记录
01 → 桶3 (局部深度=2): 包含哈希值前缀为01的记录
10 → 桶1 (局部深度=2): 包含哈希值前缀为10的记录
11 → 桶2 (局部深度=2): 包含哈希值前缀为11的记录

```

## 四、优缺点分析

### 优点

1. **渐进式增长**：目录大小随需扩展，不需要一次性重建整个哈希表
2. **局部重组**：分裂只影响单个桶，其他桶不受影响
3. **动态适应**：能根据数据分布自动调整
4. **查找效率高**：通常只需一次磁盘访问
5. **支持并发**：可以有效实现并发控制

### 缺点

1. **空间开销**：目录可能存在冗余指针
2. **不均匀分布**：在最坏情况下可能退化（所有记录哈希到同一桶）
3. **实现复杂**：相比简单哈希表，实现和维护更复杂

## 五、适用场景

- **数据库索引**：特别适合作为数据库的哈希索引实现
- **缓存系统**：可以作为高效的缓存数据结构
- **高动态数据集**：数据量经常变化的环境
- **磁盘存储**：设计适合以页为单位的外存数据结构

可扩展哈希特别适合数据库系统，因为它减少了磁盘访问次数，并且支持高效的增删改查操作，同时能够适应数据量的动态变化。
