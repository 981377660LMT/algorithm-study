# 加速 V8 正则表达式：消除内耗

# Speeding up V8 regular expressions

V8 重构了其内部的正则表达式执行路径，旨在减少 JS 与 C++ 之间的切换成本。

### 1. 痛点：频繁的运行时跳转

正则表达式的复杂匹配以往需要频繁地从 JIT 代码跳转回 C++ 运行时（Runtime）。这种跨语言边界的调用不仅破坏了 CPU 的寄存器分配，还带来了显著的上下文切换开销。

### 2. 解决方案：CodeStubAssembler (CSA)

V8 利用其底层可移植汇编工具 CSA，将大量的正则操作重写为可以直接在生成的机器码中内联执行的逻辑。这意味着 `String.prototype.replace` 等操作现在能更多地停留在高度优化的生成的代码中，减少了对 C++ 侧的依赖。

### 3. 一针见血的见解

正则优化不仅仅是“匹配算法”的竞争，更是“集成度”的竞争。通过将匹配逻辑“机器化”并尽可能减少中转，V8 让正则匹配在高频大文本处理中表现得更像原生的 C 语言代码。
