# 内存的精确革命

# V8 release v3.6: Tagged Pointers and object memory efficiency

这是 V8 早期最稳固的架构特征。

### 1. Tagged Pointers (标记位指针)

V8 使用了一个非常精妙的设计来区分整数和指针。
由于内存地址通常是 4 字节或 8 字节对齐的，地址的最后一位总是 0。V8 利用了这一点：

- 如果最后一位是 0，代表这是一个 **Smi**（小整数，经过位移处理）。
- 如果最后一位是 1，代表这是一个 **HeapObjectPointer**（堆对象指针）。
  这种设计让 V8 在 2008 年就免于像当时其他引擎那样需要装箱（Boxing）所有数字。

### 2. 内存压缩回收 (Compact GC)

由于 V8 持有的是精确指针，它可以安全地在堆内存中移动对象并更新所有引用。这个版本改进了老生代的压缩逻辑，有效防止了内存碎片。

### 3. 一针见血的见解

内存布局决定了性能的上限。V8 的 Tagged Pointers 机制是它能横扫同时代对手的“内功”，它避免了所有数字计算时的堆内存分配，使得 JS 的算术运算从第一天起就接近原生。
