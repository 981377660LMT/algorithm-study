# 告别哈希表：隐藏类的威力

# V8 release v3.5: Hidden Classes (Maps) and Inline Caching

这篇文章回顾了 V8 最初的三大支柱之一。

### 1. 从“包包”到“结构体”

其他引擎把对象看作一个 `Map<String, Value>` 的哈希表，查找速度极其平庸。
V8 提出了 **Hidden Classes (Maps)** 的概念：

- 当你创建 `{x:1, y:2}` 时，V8 会动态创建一个隐藏类。
- 这个隐藏类记录了属性 `x` 和 `y` 在对象内存中的固定偏移量。
  这样做使得属性访问从“查字典”变成了“查索引”。

### 2. Inline Caching (IC)

在单条指令级别进行缓存。如果一次操作识别到某处的隐藏类是固定的，它就直接把对应的偏移量和读取指令给“写死”在调用点上。

### 3. 一针见血的见解

隐藏类是 JS 引擎历史上的普罗米修斯之火。它将动态的对象行为强行规约到静态的内存布局上。这一发明的意义不仅仅是提速，它彻底推翻了“脚本语言就该慢”的偏见，将动态语言的工业实操推向了一个全新的维度。
