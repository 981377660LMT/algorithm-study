# 更快的 JavaScript 调用：移除适配帧

# Faster JavaScript calls: Removing Arguments Adaptor Frames

V8 团队通过一项巧妙的栈布局重构，彻底移除了困扰引擎多年的“参数适配帧”。

### 1. 历史瓶颈：Arguments Adaptor Frame

当 JS 调用参数个数与形参不匹配（Under/Over-application）时，V8 会创建一个特殊的“适配帧”来平衡栈。

- **作用**：确保被调用者始终能从固定位置找到参数。
- **代价**：增加了栈遍历开销，且在 JIT 编译时会引入复杂的中转桩（Stub）代码。

### 2. 技术突破：反转参数顺序 (Reversing arguments)

V8 决定不再在调用时动态调整栈，而是改变了整体的参数压栈顺序。

- **原理**：通过反转栈中参数的存放顺序，使得 Receiver 和所有实参可以通过一个简单的线性偏移（不依赖形参数量）直接访问。
- **性能飞跃**：移除适配帧让解释器（Ignition）性能提升约 **11%**。在参数不匹配的调用场景下，TurboFan 的性能提升甚至能达到 **40%**。

### 3. 一针见血的见解

移除适配帧不仅是简单的代码精简，它代表了 V8 对“函数调用”这一核心原子操作的底层重塑。通过回归更简洁、更符合原生 CPU 习惯的栈模型，V8 极大地提高了代码生成的效率，让 JS 的动态性不再成为性能的绊脚石。
