# V8 v7.8 发布：加速对象解构与惰性源码映射

## V8 release v7.8

- **Original Link**: [https://v8.dev/blog/v8-release-78](https://v8.dev/blog/v7.8)
- **Publication Date**: 2019-09-27
- **Summary**: V8 v7.8 改进了对象解构的性能，引入了惰性源码位置（Lazy Source Positions）以节省内存，并实现了更快的正则匹配失败处理。

---

### 1. 核心改进

#### A. 更快的对象解构

以往 `const {x, y} = obj` 比 `const x = obj.x; const y = obj.y` 慢，因为规范要求解构必须检查 `obj` 是否为 `null` 或 `undefined`。

- **优化**：V8 7.8 现在生成的字节码对于这两者是完全一致的。它不再执行显式的零值检查，而是通过截获加载属性时的异常来处理规范边界，从而达到相同速度。

#### B. 惰性源码位置 (Lazy Source Positions)

V8 以前在编译字节码时会生成庞大的位置映射表，用于出错时定位代码行号。

- **改进**：现在默认不生成这些表。只有在真正读取 `error.stack` 或打开调试器时，才重新解析和编译函数以获取位置。
- **结果**：V8 堆内存减少了 **1% - 2.5%**，这对于内存受限的移动设备很有意义。

#### C. 正则匹配失败加速

对于不匹配的正则表达式，V8 引入了跳过逻辑。如果当前输入字符串剩余长度已经小于正则表达式要求的最小长度，V8 会立即宣布失败，而不是继续逐字匹配。

### 2. WebAssembly 增强

- **Wasm C/C++ API 正式支持**：允许 C++ 应用直接嵌入 V8 作为 Wasm 执行引擎，无需 JS 介入。
- **启动时间优化**：通过更高效的背景线程调度，大幅减少了 Wasm 包装器（Wrappers）的编译时间。

### 3. API 变动

- `v8::Isolate` 的一些内部组件被移出主结构，以提高多隔离实例环境下的缓存局部性。

### 4. 总结

v7.8 是一个“性能微操”版本，通过许多细小的底层优化（如惰性加载），在不改变语义的前提下，进一步榨取了内存和 CPU 资源。
