# 秋季大扫除：优化 V8 内存占用

# Fall cleaning: Optimizing V8 memory usage

这篇博客揭示了 V8 为了支持“只有 512MB 内存”的移动设备所做的高考级努力。

### 1. 内存减重模式 (Memory Reduction Mode)

V8 引入了专项模式，当探测到系统处于内存压力下时，GC 会进入“狂暴模式”：

- **更彻底的整理**：不再保留那么多 Slack（冗余空间）。
- **强制标记结束**：不等空闲时间，直接在后台加速完成增量标记。
- **内存回收与压缩**：更加频繁地将不再使用的物理内存页归还给操作系统。

### 2. 解析器内存优化

AST（抽象语法树）以往存储在 Zone 内存中，且释放不够及时。V8 改进了 Zone 的生命周期管理，并对 AST 节点进行了位打包（Bit-packing），使得解析阶段的峰值内存占用了降低了约 40%。

### 3. 一针见血的见解

内存優化是“毫末之争”。V8 通过减小页面尺寸（1MB -> 512KB）和打包基础数据结构，证明了大型复杂软件在面对硬件限制时，必须具备极强的底层重构能力和对每一比特的吝啬精神。
