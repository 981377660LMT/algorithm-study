# V8 v7.7 发布：后台编译与内存优化

# V8 release v7.7: Background compilation and memory optimization

V8 v7.7 通过并行化和延迟分配策略，进一步压榨了启动性能和内存效率。

### 1. 启动加速：后台字节码编译

在此版本之前，虽然 V8 可以并行解析脚本，但字节码生成（Compilation）过程仍可能阻塞主线程。v7.7 实现了将编译任务完全移至后台线程执行，甚至可以与脚本下载并行进行。这意味着当下载完成时，主线程几乎可以立即开始执行代码，极大地降低了可交互时间（TTI）。

### 2. 内存节约：延迟反馈向量分配 (Lazy Feedback Vector Allocation)

V8 的内联缓存（IC）依赖于反馈向量来存储运行时类型信息。以往，V8 在函数初次解析时就会为其分配反馈向量。
调查发现，许多 JS 代码只运行一次。v7.7 改为仅在函数被多次调用变“热”后才分配反馈向量，这在典型的重脚本页面中能节省 10% 以上的堆内存占用。

### 3. 指令集优化：x64 栈相对寻址

针对 x64 平台，改进了跳转指令的编码方式。通过使用更高效的相对寻址模式，减少了生成指令的大小，对大型 JS 文件的加载和内存占用都有所裨益。

### 4. 一针见血的见解

v7.7 的核心思路是“精益生产”：不预先准备不需要的数据（延迟分配），并且让闲置的 CPU 核心在后台工作（并行编译）。这种策略在移动端低速网络环境下，对加载体验提升尤为明显。
