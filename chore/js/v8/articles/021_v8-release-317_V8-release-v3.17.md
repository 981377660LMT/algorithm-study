# 分配点追踪：赋予编译器“记忆”

# V8 release v3.17: Allocation Site Tracking

这是 V8 引入的一种极具前瞻性的优化技术。

### 1. 经验主义的内存分配

V8 开始在每个数组分配点（即脚本中的每一行 `[]`）记录产生的数组类型。
如果某个特定的分配点最近一直产出 `DOUBLE_ELEMENTS`（全是浮点数），V8 下次执行这里时，会直接预设分配一个浮点数数组空间。
在此之前，V8 总是先预测为 `SMI_ELEMENTS`（整数），一旦遇到第一个浮点数就会发生昂贵的 **Elements Kind Transition**（强制类型转换）。

### 2. 避免去优化的恶性循环

通过分配点追踪，编译器可以生成针对特定类型优化的代码，而不需要在每次类型变化时都推倒重来。

### 3. 一针见血的见解

这是 V8 第一次尝试在内存分配阶段注入“历史经验”。它让编译器具备了跨执行周期的自我进化能力，不再是一个冷冰冰的翻译机器，而是一个能够通过“回顾过去”来预测代码未来的智能虚拟机。
