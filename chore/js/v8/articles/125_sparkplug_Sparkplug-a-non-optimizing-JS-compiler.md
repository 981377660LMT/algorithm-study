# Sparkplug：一个非优化型 JavaScript 编译器

# Sparkplug — a non-optimizing JavaScript compiler

Sparkplug 是 V8 架构在 2021 年的一次天才补位，它填补了解释器与顶级编译器之间的巨大鸿沟。

### 1. 核心原理：为什么它能跳过 IR？

与以往的编译器不同，Sparkplug 并不生成复杂的中间表示（IR，如 Sea-of-Nodes）。

- **线性转换**：它直接线性遍历由 Ignition 生成的字节码（Bytecode）。
- **镜像栈帧 (Mirroring the Stack Frame)**：它不进行复杂的寄存器分配，而是直接复制（Mirror）解释器的栈布局。这意味着字节码中的每个虚拟寄存器在 Sparkplug 生成的机器码中都有一个固定的栈位置。

### 2. 技术优势：极速的代码生成

- **单遍扫描**：由于没有优化逻辑和图构建过程，Sparkplug 就是将字节码序列翻译成对应的机器码片段（Builtins 调用）。
- **极简分配**：省去了昂贵的寄存器分配算法，使其编译速度呈线性增长。

### 3. 一针见血的见解

Sparkplug 深刻印证了编译器设计中的“快即是美”。它不追求生成代码的巅峰性能，而是追求“将字节码变成机器码”这一过程本身的速度。它的存在让 V8 在代码“热”起来的最初几毫秒内，就能提供比解释器强数倍的动力，完美解决了现代 Web 应用冷启动时的性能断裂感。
