# 极致解析（一）：扫描器优化的底层细节

# Blazingly fast parsing, part 1: optimizing the scanner

解析的第一步是扫描（Scanning），V8 是如何将原始字节流高速转化为 Token 的？

### 1. 字符流抽象的代价

为了处理 Latin1、UTF-8、UTF-16 等多种复杂的字符编码，V8 设计了一个高度优化的 `CharacterStream` 抽象。文章解析了如何通过 C++ 模板和分支预测提示（Branch Prediction），让扫描循环在大多数情况下都能命中“快路径”。

### 2. 空白符与标识符的高效处理

扫描器最耗时的部分是处理空白符和识别冗长的标识符。

- V8 使用了精心设计的查找表（Lookup Tables）来判断字符类型。
- 引入了基于 **Perfect Hashing (完美哈希)** 的关键字匹配，确保像 `instanceof` 这样长关键字的识别速度与 `if` 这种短关键字一样快。

### 3. 一针见血的见解

性能优化往往就在那几行最核心的 `while` 循环里。V8 对扫描器的优化证明了：即使是像“读字符”这样基础的操作，在处理以 GB 计的源代码时，哪怕每个字节多省一个机器周期，最终的收益也是巨大的。
