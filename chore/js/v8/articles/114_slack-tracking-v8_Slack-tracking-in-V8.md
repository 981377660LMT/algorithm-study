# V8 中的空闲追踪：极致的内存利用率

# Slack tracking in V8: Maximizing memory efficiency

V8 通过一项名为 “Slack Tracking” 的动态反馈机制，解决了 JavaScript 对象因动态性导致的内存碎片问题。

### 1. 技术悖论：预留空间 vs 实际使用

JS 对象可以在运行时动态添加属性。为了避免频繁重分配，V8 初始会给新对象预留一些空闲空间（Slack，默认为 8 个槽位）。但如果对象此后不再添加属性，这些预留空间就变成了永久的浪费。

### 2. 核心原理：魔法数字 7

- **初期反馈**：V8 会为一个特定的构造函数维护计数器。在前 7 个实例创建期间，引擎会记录这些对象实际利用了多少属性槽。
- **动态收缩**：一旦基准建立，V8 会立即调整该构造函数的对象布局，收缩后续实例的大小。
- **Filler Map**：对于已经创建的旧对象，V8 会用极小开销的占位符（Filler Map）填充未使用的空位，使得 GC 可以在不影响性能的前提下回收这些物理空间。

### 3. 一针见血的见解

`Slack Tracking` 展示了 V8 在“运行中自我进化”的特质。它既保留了 JS 动态添加属性的便利，又通过统计学手段自动纠正了过度预留带来的浪费。这种在毫秒级微调对象布局的能力，是 V8 能够让大规模 Web 应用在低内存设备上维持稳定的核心保障。
