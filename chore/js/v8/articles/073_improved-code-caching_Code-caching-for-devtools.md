# 73. Code caching for devtools | 为 DevTools 提供代码缓存：更快的加载体验

代码缓存（Code Caching）是 V8 提升重复访问速度的核心技术。此版本对缓存机制进行了深度优化。

## 1. 传统局限：顶层函数缓存

之前版本的 V8 只会为脚本的顶层函数（Tope-level functions）生成热启动缓存。

- **问题**：大多数现代 JS 代码包裹在模块或立即执行函数 (IIFE) 中，内部含有大量惰性编译（Lazy Compiled）的函数。

## 2. 改进：全脚本缓存

V8 改进了启发式算法，现在会缓存更多在页面加载过程中实际执行过的函数。

- **执行后缓存**：V8 可以在脚本执行一次后，记录下哪些函数被编译了，并将这些字节码序列化到磁盘。

## 3. 针对 DevTools 的优化

配合 Chrome DevTools，开发者可以更清晰地分析页面的编译开销。

- **缓存命中率追踪**：DevTools 的 Performance 面板开始显示脚本是否命中了代码缓存，这帮助开发者调整代码粒度，以获得最佳的缓存效果。

## 4. 后台反序列化 (Lazy Deserialization)

即使有了缓存，将缓存读取到内存也是有开销的。V8 引入了异步反序列化，防止恢复大量缓存字节码时阻塞主线程。

- **收益**：对于像 Facebook 这种拥有数兆 JS 代码的网站，二次访问的启动时间缩短了 **20% 左右**。
