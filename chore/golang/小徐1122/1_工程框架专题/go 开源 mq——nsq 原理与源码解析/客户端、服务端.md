客户端和服务端在 nsq 中各自承担不同的角色，但它们又紧密协同，共同构成一个完整的消息队列系统：

1. **服务端（nsqd）**

   - 负责接收、存储和发送消息。
   - 实现消息持久化、转发以及消息 ack、重试等机制。
   - 维护 topic、channel、消费者组等数据结构，并处理与客户端的 TCP 通信。
   - 作为守护进程运行，其运行稳定性直接保证整个消息队列的高可用性。

2. **客户端（Producer 和 Consumer）**

   - Producer 负责向 nsqd 发布消息；Consumer 负责从 nsqd 订阅、接收并处理消息。
   - **客户端通过封装的连接类（如 nsq 的 Conn）建立与服务端的 TCP 连接，并启动独立的 goroutine 进行读写处理。**
   - 客户端要处理消息的业务逻辑，与服务端的通信不仅涉及数据传输，还需要回传 ack 来保证消息不会重复投递。

3. **区别与联系**
   - **区别**：
     - 服务端是后端消息处理模块，提供存储、转发、容错等能力；
     - 客户端专注于消息的生产和消费，重点在于业务逻辑的实现及与服务端的数据交互。
   - **联系**：
     - 客户端与服务端通过 TCP 连接通信，**生产者将消息发送到服务端，消费者从服务端拉取消息**；
     - 服务端依赖客户端的 ack 反馈来判断消息的消费状态，从而实现消息的可靠传递；
     - 两者共同构成了一个完整的消息传递和处理链条，确保系统在高并发和分布式环境下的稳定运行。
