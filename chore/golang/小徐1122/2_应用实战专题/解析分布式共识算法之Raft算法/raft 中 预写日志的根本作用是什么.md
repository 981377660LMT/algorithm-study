在 Raft 协议中，**预写日志（即日志复制机制）的根本作用是通过`顺序化、持久化和多节点同步`操作，确保分布式系统在动态和故障场景下的强一致性**。具体表现为以下核心目标：

---

### 1. **顺序化操作：构建唯一操作序列**

- Raft 要求所有状态变更（例如写请求）必须通过 Leader 节点生成日志条目，并严格按照顺序追加到日志中。
- **作用**：所有节点以相同的顺序应用相同的操作，避免因操作顺序不一致导致状态机分歧（例如并发写冲突）。

---

### 2. **持久化：故障后恢复的依据**

- 日志条目在被提交（Commit）前，必须被持久化存储到 Leader 和多数 Follower 节点的磁盘中。
- **作用**：即使节点崩溃重启，仍能通过日志重放恢复崩溃前的状态，确保数据不丢失。

---

### 3. **多节点同步：实现强一致性**

- Leader 将日志条目复制到多数节点后，才标记为“已提交”（Committed），此时该操作被视为全局生效。
- **作用**：保证集群中多数节点在任何时刻都拥有相同的日志历史，从而对外呈现一致的视角（即使部分节点故障或网络分区）。

---

### 4. **容错与状态机安全**

- **Leader 变更容错**：新 Leader 必须拥有最新的日志，并通过强制其他节点复制自己的日志来消除不一致。
- **状态机安全性**：只有已提交的日志条目才允许被应用到状态机，确保所有节点最终应用相同的操作序列。

---

### 5. **解决网络延迟与分区问题**

- 通过日志条目的索引（Index）和任期号（Term），Raft 能检测并修复过期的日志（例如旧 Leader 残留的未提交日志），防止过时操作被错误提交。

---

### 类比与扩展：与数据库 WAL 的异同

- **相似性**：Raft 的日志复制机制与传统数据库的预写日志（WAL）均遵循“先记录日志，后生效操作”的原则，确保操作可追溯和持久化。
- **差异性**：Raft 的日志是分布式、多副本的，需跨节点同步以实现一致性，而传统 WAL 通常仅关注单节点持久化。

---

### 总结

Raft 的预写日志机制通过**顺序化、持久化、多副本同步**三个核心手段，将复杂的分布式一致性问题转化为对日志顺序和多数派达成的一致性控制。这是 Raft 能在网络分区、节点故障等不确定环境下仍保证系统正确性的基石。
