// !gcd里递归不加判断 会死循环(b站之前lua脚本 入参变成字符串 就是这样挂掉的)
const gcd = (a: number, b: number): number => {
  if (Number.isNaN(a) || Number.isNaN(b)) {
    return NaN
  }

  return b === 0 ? a : gcd(b, a % b)
}

// !注意js中超过浮点数最大值的数会变成Infinity
const lcm = (a: number, b: number): number => (a / gcd(a, b)) * b

function subarrayLCM(nums: number[], k: number): number {
  let res = 0
  for (let i = 0; i < nums.length; i++) {
    let lcm_ = 1 // 幺元
    for (let j = i; j < nums.length; j++) {
      lcm_ = lcm(lcm_, nums[j])
      if (lcm_ === k) {
        res += 1
        // !这里是关键
      } else if (lcm_ > k) {
        break
      }
    }
  }
  return res
}

//
// 472
console.log(
  subarrayLCM(
    [
      475, 788, 834, 670, 254, 56, 431, 155, 818, 624, 795, 397, 51, 319, 227, 899, 806, 985, 296,
      235, 331, 227, 209, 75, 556, 416, 206, 756, 988, 440, 109, 324, 160, 276, 997, 719, 19, 317,
      971, 191, 599, 484, 380, 255, 637, 964, 538, 767, 84, 726, 833, 820, 143, 735, 142, 240, 451,
      558, 957, 633, 853, 212, 970, 78, 137, 296, 557, 535, 605, 374, 806, 604, 191, 518, 854, 583,
      653, 584, 761, 980, 634, 545, 312, 34, 888, 611, 628, 217, 451, 152, 161, 739, 514, 80, 870,
      791, 848, 127, 710, 408, 722, 559, 437, 67, 248, 475, 775, 794, 230, 431, 770, 376, 772, 997,
      681, 97, 373, 682, 604, 566, 375, 674, 225, 49, 862, 633, 144, 189, 170, 787, 92, 825, 721,
      379, 112, 151, 814, 536, 939, 777, 757, 910, 15, 89, 707, 45, 950, 445, 632, 764, 5, 143, 455,
      854, 496, 475, 16, 333, 734, 440, 768, 911, 645, 462, 830, 779, 372, 311, 381, 402, 233, 573,
      63, 138, 270, 886, 852, 654, 342, 58, 922, 372, 939, 438, 613, 939, 955, 275, 113, 232, 604,
      522, 87, 89, 555, 962, 701, 642, 890, 110, 218, 540, 331, 260, 886, 449, 795, 961, 687, 120,
      716, 468, 538, 468, 331, 931, 936, 130, 872, 765, 349, 726, 598, 641, 111, 654, 339, 964, 187,
      174, 183, 816, 644, 884, 559, 889, 383, 764, 934, 15, 855, 532, 541, 703, 277, 775, 858, 176,
      901, 625, 931, 529, 119, 925, 767, 12, 580, 850, 342, 975, 52, 369, 358, 158, 748, 916, 857,
      594, 159, 276, 558, 137, 426, 27, 196, 955, 831, 722, 539, 762, 276, 647, 105, 350, 656, 889,
      524, 615, 825, 851, 722, 528, 721, 569, 544, 331, 845, 509, 808, 155, 118, 314, 592, 57, 201,
      90, 673, 455, 500, 108, 493, 78, 596, 928, 939, 537, 976, 909, 202, 313, 820, 806, 642, 337,
      232, 917, 780, 230, 113, 782, 365, 393, 334, 575, 699, 318, 435, 880, 886, 346, 31, 964, 398,
      288, 812, 707, 849, 783, 12, 619, 409, 115, 728, 423, 274, 702, 154, 24, 801, 312, 858, 49,
      604, 118, 919, 397, 430, 351, 157, 113, 977, 331, 724, 996, 885, 243, 20, 710, 482, 916, 143,
      429, 977, 957, 128, 526, 536, 189, 618, 881, 850, 819, 426, 736, 616, 572, 978, 28, 571, 620,
      120, 590, 459, 113, 799, 795, 376, 855, 331, 821, 511, 782, 331, 583, 555, 860, 794, 167, 469,
      78, 777, 218, 72, 791, 429, 10, 392, 987, 19, 106, 564, 391, 650, 286, 291, 261, 25, 939, 669,
      465, 212, 102, 738, 64, 225, 576, 660, 382, 324, 564, 425, 955, 417, 859, 541, 998, 747, 833,
      856, 761, 242, 722, 285, 714, 53, 847, 990, 928, 714, 67, 648, 643, 949, 168, 130, 787, 106,
      505, 497, 108, 318, 71, 157, 207, 231, 19, 822, 33, 141, 386, 242, 126, 760, 359, 451, 928,
      837, 556, 44, 260, 376, 511, 621, 790, 330, 442, 683, 688, 745, 552, 464, 750, 762, 218, 256,
      483, 509, 659, 374, 659, 186, 77, 284, 184, 456, 108, 746, 592, 476, 391, 300, 621, 268, 233,
      628, 96, 140, 193, 739, 835, 897, 297, 43, 399, 178, 75, 720, 807, 150, 72, 263, 487, 288,
      322, 276, 989, 727, 589, 618, 582, 471, 818, 542, 687, 40, 833, 275, 117, 522, 375, 217, 989,
      404, 182, 936, 430, 758, 557, 970, 16, 254, 619, 622, 602, 193, 697, 984, 864, 70, 906, 793,
      683, 457, 817, 411, 977, 102, 769, 617, 547, 549, 630, 852, 385, 64, 94, 783, 431, 691, 191,
      993, 195, 557, 639, 778, 984, 185, 647, 5, 767, 458, 785, 655, 482, 248, 976, 52, 578, 752,
      936, 824, 996, 882, 904, 663, 712, 138, 951, 300, 835, 596, 72, 80, 52, 466, 14, 408, 584,
      877, 489, 283, 652, 826, 934, 413, 283, 271, 415, 69, 13, 756, 914, 43, 647, 318, 574, 614,
      508, 742, 993, 878, 834, 407, 522, 402, 551, 787, 514, 534, 217, 698, 907, 858, 334, 37, 111,
      322, 360, 774, 834, 887, 308, 138, 597, 901, 556, 242, 102, 756, 782, 585, 158, 568, 724, 788,
      462, 447, 957, 446, 451, 973, 801, 568, 893, 391, 843, 108, 774, 995, 93, 307, 418, 689, 545,
      288, 702, 661, 981, 637, 968, 874, 142, 450, 827, 843, 532, 908, 854, 735, 721, 990, 202, 189,
      603, 416, 568, 489, 612, 638, 227, 358, 36, 175, 942, 9, 679, 771, 292, 767, 303, 320, 653,
      160, 192, 679, 536, 942, 999, 445, 534, 384, 665, 482, 150, 276, 563, 697, 612, 870, 873, 158,
      578, 476, 549, 331, 790, 290, 148, 445, 950, 729, 909, 514, 27, 441, 264, 295, 147, 923, 455,
      597, 934, 354, 79, 257, 917, 430, 863, 135, 903, 128, 517, 466, 837, 130, 351, 693, 480, 176,
      844, 442, 388, 531, 638, 397, 920, 791, 947, 82, 961, 97, 607, 566, 610, 136, 898, 907, 163,
      955, 69, 933, 201, 287, 101, 879, 13, 10, 83, 771, 902, 193, 357, 893, 41, 823, 175, 289, 63,
      247, 131, 685, 2, 769, 482, 390, 163, 500, 744, 202, 610, 435, 298, 708, 167, 328, 129, 506,
      611, 753, 404, 989, 245, 623, 212, 313, 174, 257, 353, 213, 152, 818, 204, 684, 764, 229, 258,
      671, 364, 339, 862, 783, 460, 474, 667, 582, 740, 214, 840, 758, 982, 704, 452, 862, 756, 411,
      746, 390, 656, 789, 958, 745, 574, 272, 457, 973, 556, 667, 315, 587, 702, 931, 754, 4, 688,
      855, 543, 382, 965, 184, 144, 790, 63, 390, 446, 932, 723, 617, 435, 507, 985, 333, 830, 889,
      357, 185, 497, 261, 716, 758, 473, 28, 92, 406, 706, 806, 637, 317, 175, 633, 358, 284, 316,
      981, 828, 567, 924, 988, 747, 189, 96, 89, 628, 646, 992, 144, 543, 102, 749, 193, 22, 71,
      306, 634, 410, 857, 382, 539, 538, 239, 791
    ],
    42
  )
)
