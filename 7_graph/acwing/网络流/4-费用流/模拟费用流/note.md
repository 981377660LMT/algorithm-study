## 模拟费用流·入门篇 由兔子和洞谈起的模拟费用流常规模型

https://www.cnblogs.com/Nero-Claudius/p/Simulation_of_CostFlow1.html

### 兔子进洞 1

一条数轴上有一些兔子和一些洞，兔子的坐标为 xi，洞的坐标为 yi。
每只兔子`只能往左边走`，所花代价等于行走距离。
每个洞有一个权值 vi，表示进入这个洞所需的代价。
`每只兔子不一定要进洞`，每个洞最多进一只兔子。
求最大代价。

算法流程
考虑按坐标同时枚举兔子和洞，由于代价的计算式为 xi−yj+vj，xi 确定时，就是要找最大的 −yj+vj，这只要开个堆即可求出。模拟费用流有一个十分核心的退流（后悔）操作，即若第 i 只兔子选择了第 j 个洞，就把 −yj+vj 从堆中弹出（每个洞最多进一只兔子），再把 −xi 加入堆中。

- 将所有兔子和洞一起按坐标排序，然后按坐标从小到大枚举兔子和洞。
- 对于第 i 只兔子，取出当前堆顶 top，判断 xi+top 是否大于 0：
- xi+top>0：更新答案，弹出堆顶，并将 −xi 加入堆中，以便后续退流。
- xi+top≤0：说明不会使答案变优，不进行操作。
- 对于第 j 个洞，将 −yj+vj 加入堆中。

### 兔子进洞 2

一条数轴上有一些兔子和一些洞，兔子的坐标为 xi，洞的坐标为 yi。
每只兔子`只能往左边走`，所花代价等于行走距离。
每个洞有一个权值 vi，表示进入这个洞所需的代价。
`每只兔子一定要进洞`，每个洞最多进一只兔子。
求最小代价。

由于每只兔子一定要进洞，**那么只要在一开始就让所有兔子都和一个距离它 INF 的洞匹配**。
这样一来，这个匹配无论如何都无法退流，也就实现了所有兔子都进洞。
具体操作步骤和上面大体相同，只是无论 xi+top 是否大于 0 都必须更新答案，这里略去。

### 兔子进洞 3

https://www.mina.moe/archives/11762
一条数轴上有一些兔子和一些洞，兔子的坐标为 xi，洞的坐标为 yi。
每只兔子`可以往左右两边走`，所花代价等于行走距离。
每个洞有一个权值 vi，表示进入这个洞所需的代价。
`每只兔子一定要进洞`，每个洞最多进一只兔子。
求最小代价。

## 模拟费用流·进阶篇 继兔子和洞而论的模拟费用流进阶模型

https://www.cnblogs.com/Nero-Claudius/p/Simulation_of_CostFlow2.html

### 兔子进洞 4 (雪灾与外卖)

一条数轴上有一些兔子和一些洞，兔子的坐标为 xi，洞的坐标为 yi。
`每个位置上的兔子和洞都有一个数量（1e9 级别）。`
每只兔子可以往`左右两边走`，所花代价等于行走距离。
每个洞有一个权值 vi，表示进入这个洞所需的代价。
`每只兔子一定要进洞`，每个洞最多进一只兔子。
求最小代价。

只要把一个位置上的洞**用 pair 绑起来**，然后同样按照常规模型的做法去做即可

### 兔子进洞 5

一条数轴上有一些兔子和一些洞，兔子的坐标为 xi，洞的坐标为 yi。
每个位置上的兔子和洞都有一个数量（1e9 级别），`且每个位置上的洞必须匹配至少一个`。
每只兔子可以往左右两边走，所花代价等于行走距离。
每个洞有一个权值 vi，表示进入这个洞所需的代价。
每只兔子一定要进洞，每个洞最多进一只兔子。
求最小代价。

假设一个位置上有 ci 个洞，`则把它拆开，变成 1 个必须匹配的洞和 ci−1 个一般的洞`。
**考虑如何让一个洞一定会匹配，实际上只要给它的权值减去 INF，最终给答案加上洞数 ×INF 即可。**

### 兔子进洞 6 (树上)

https://leetcode.cn/problems/YWWN3V/ (字节/bytedance-016. 最短移动距离)
一棵树上有一些兔子和一些洞，兔子所在节点编号为 xi，洞所在节点编号为 yi。
每只兔子可以任意走，`所花代价等于行走距离（树上距离）。`
每个洞有一个权值 vi，表示进入这个洞所需的代价。
每只兔子一定要进洞，每个洞最多进一只兔子。
求最小代价。

由于它是树，我们可以直接从下往上做，每次合并信息并上传。
**数轴版本要用堆维护，此时树上版本要合并信息，自然就是左偏树（可并堆）**

## 模拟费用流·总结篇 抛开模型看模拟费用流的本质

给定两个长度为 n 的整数序列{ai},{bi}。
要求在两个序列中分别选出恰好 K 个数，其中至少有 L 对数下标相同。
求出数的总和的最大值。
数据总数 ≤10，∑n≤1e6，1≤L≤K≤n≤2×1e5，1≤ai,bi≤1e9

其余文章
https://www.mina.moe/archives/11762
https://www.cnblogs.com/Forever-666/p/14623282.html
